* [TODO] [#A] Virtualbox
  Agregar a la guia actual

** 1. Instalacion de Virtualbox
   Nos aseguramos de instalar una version que se adapte a nuestro kernel

   #+BEGIN_SRC sh
     # La version que nos diga sera la que agregamos
     mhwd-kernel -li
     # Instalamos virtualbox (suponiendo que tu kernel es linux54)
     sudo pacman -Syu virtualbox linux54-virtualbox-host-modules
     # Cargamos virtualbox
     sudo vboxreload
     # Instalamos la version extendida que agrega nuevas funcionalidades
     pamac build virtualbox-ext-oracle
     # Agregamos el usuario actual al grupo de usuarios vbox
     sudo gpasswd -a $USER vboxusers
   #+END_SRC
   
** 2. Instalar Vagrant

   #+BEGIN_SRC sh
     # Instalamos vagrant
     pacman -S vagrant
     # Instalamos plugins 
     # vagrant plugin install vagrant-vbguest vagrant-share
     # creamos directorio donde instalar sl ervidor
     mkdir manu-server 
     cd manu-server 
     # Inicializamos con una distribucion centos 7 como servidor linux
     # vagrant box add centos-7.0-x86_64.box --name centos7

     # vagrant init centos/7
     vagrant init ubuntu/trusty64

     # Descargamos e instalamos el servidor linux 
     vagrant up 
     # Nos conectamos al servidor
     vagrant ssh
   #+END_SRC
   
   | Comando           | Descripcion                                |
   | :------           | :----------                                |
   | vagrant provision | Instalar paquetes agregados en Vagrantfile |
   | vagrant halt      |                                            |
   | vagrant up        | Descargar e instalar un box                |
   | vagrant ssh       | Conectarse al servidor                     |
   | vagrant init      | Inicializar                                |

   
   *Referencias*
   - https://wiki.archlinux.org/index.php/Vagrant
   - https://www.vagrantup.com/docs/boxes/base.html
   - https://www.vagrantup.com/intro/getting-started/provisioning.html
   - https://dev.to/psnebc/vagrant-package-and-vagrant-box-add-8of
   - https://medium.com/@Joachim8675309/vagrant-provisioning-e4c9fd57968d
   - https://scotch.io/courses/getting-started-with-vagrant-for-local-development/provisioning-vmprovision-how-to-customize-the-box
   - https://blog.ipswitch.com/installing-your-first-vagrant-box
   - https://computingforgeeks.com/how-to-addinstall-and-run-centos-7-vagrant-box-to-virtualbox-using-vagrant/

** 3. Configurar Servidor
   En este caso usaremos ubuntu/trusty64
   No tuve que crear particiones extra (chequear con blogs, y mas info por si acaso)

   Compartir Carpetas
   - https://blog.theodo.com/2017/07/speed-vagrant-synced-folders/
   - https://www.vagrantup.com/docs/synced-folders/basic_usage
   - https://stackoverflow.com/questions/19231895/how-to-share-a-folder-created-inside-vagrant
   
   Referencias
   - https://www.2daygeek.com/how-to-resize-active-primary-root-partition-in-linux-using-gparted-utility/
   - https://access.redhat.com/articles/1190213
   - https://kwilson.io/blog/format-a-linux-disk-as-ext4-from-the-command-line/
   - https://www.tecmint.com/create-new-ext4-file-system-partition-in-linux/
   -
** 4. Configurar red
   La idea es poder correr algun servidor web por ejemplo con prolog
   y poder acceder via tu maquina

   - https://www.oreilly.com/library/view/vagrant-up-and/9781449336103/ch04.html
   - https://www.vagrantup.com/docs/networking/public_network.html
   - https://stackoverflow.com/questions/33250304/how-to-automatically-select-bridged-network-interfaces-in-vagrant
** Referencias
   - https://wiki.manjaro.org/index.php?title=VirtualBox
   - https://www.profesionalreview.com/2018/11/19/virtualbox-extension-pack/
   - https://www.hostinger.com.ar/tutoriales/centos-vs-ubuntu-elegir-servidor-web/
   - https://webtematica.com/centos-o-debian-para-servidores-web
   - https://www.sinologic.net/2011-02/porque-debian-no-centos.html
     
* Docker
** Comandos básicos
   + El parámetro *ps* es como en linux normal, muestra los procesos en ejecución por tanto mostrará los containers activos (en ejecución)

   |------------------------------------------+-------------------------------------------------------------------------|
   | Comando                                  | Descripción                                                             |
   |------------------------------------------+-------------------------------------------------------------------------|
   | docker start                             |                                                                         |
   | docker stop                              |                                                                         |
   | docker restart                           |                                                                         |
   | docker images                            |                                                                         |
   | docker run                               |                                                                         |
   | docker exec                              |                                                                         |
   |------------------------------------------+-------------------------------------------------------------------------|
   | docker search algunContainer             | Buscar un container                                                     |
   | docker images                            | Listar containers ya instalados (entorno local)                         |
   | docker ps                                | Listar containers en ejecución                                          |
   | docker ps -a # -all                      | Listar (all) todos los containers (activos/inactivos)                   |
   | docker ps -l # -list                     | Listar (list) últimos containers creados                                |
   | docker restart IDdeAlgun                 | Reiniciar un container (como si reiniciaras la maquina y sus servicios) |
   | docker start IDdeAlgunContainer          | Iniciar el Container como proceso(y sus servicios)                      |
   | docker stop IDdeAlgunContainer           | Detiene el Container como proceso(y sus servicios)                      |
   | docker exec IdDeAlgunContainer           | Ejecuta un comando en un container (NO CREA UNO NUEVO)                  |
   | docker run algunContainer algunComando   | Para ejecutar una linea comandos (y crea otro container)                |
   | docker rm -f IDdeAlgunContainer          | Para eliminar un container                                              |
   | docker rmi IDdeAlgunaImagen              | Para eliminar una imagen                                                |
   | docker run -it algunContainer /bin/bash  | Modo interactivo (via terminal) (Y CREA OTRO CONTAINER)                 |
   | docker exec -it algunContainer /bin/bash | Modo Interactivo (via terminal  (NO CREA UNO NUEVO)                     |
   | docker pull algunContainer               | Descargar o actualizarlo                                                |
   | docker pull algunContainer:unTag         | El tag puede ser una version especifica                                 |
   |------------------------------------------+-------------------------------------------------------------------------|
   | docker inspect IDdeAlgunContainer        | Da información COMPLETA en formato JSON                                 |
   | docker rm $(docker ps -a -q)             | Remover todos los contenedores detenido                                 |
   | docker rm $(docker images -q)            | Remover todas las imagenes                                              |
   | docker kill $(docker ps -q)              | Mata el proceso de todos los contenedores en ejecución                  |
   |------------------------------------------+-------------------------------------------------------------------------|

https://hub.docker.com/repository/docker/neverkas/distroalpine
https://www.digitalocean.com/community/tutorials/como-instalar-y-usar-docker-en-ubuntu-18-04-1-es
https://www.ionos.es/digitalguide/servidores/configuracion/tutorial-docker-instalacion-y-primeros-pasos/
https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/

*** Observaciones importantes
    + Si queremos acceder al container (NO CREAR UNO NUEVO) usamos "docker exec -it" (si usamos run se creará otro container)
    + Siempre se crea un contenedor distinto cuando ejecutas una imagen con docker run -it IdAlgunaImagen
    + Podemos usar el comando "docker run -it" para crear una nueva imagen, ejemplos.:
      #+BEGIN_EXAMPLE
      - Supongamos que tenemos un container de un ubuntu trusty (14.04) que tiene varios packages
      (Ej. haskell, prolog, git, etc...) y queremos probar un nuevo package o configuración
      como sería instalar mysql, mongodb, etc.. 
      - Entonces podemos correr el comando "docker run -it" para crear un nuevo container que tiene
      lo mismo que al que apuntamos con el ID, si no funciona lo que queriamos instalar o no era
      lo que necesitabamos borramos ese nuevo container y nos quedamos con el anterior
      #+END_EXAMPLE
    + Si queremos guardar cambios de un container, debemos versionarlo comiteando y pusheando los cambios

*** Eliminar varias imagenes
    #+BEGIN_SRC sh
      # listamos las imagenes para revisar el ID
      docker images ls

      # suponiendo que son varias imagenes se pueden agrupar en una linea
      docker rmi a23bb4013216 a341b4013200 a24bb422226
    #+END_SRC 

*** Descargar ó Actualizar un Container

    #+BEGIN_SRC sh
      # para descargar ó actualizar un container local ya existente
      docker pull algunContainer

      # para descargar una versión especifica (a partir de un tag)
      # sino especificamos suele traer la última vesión (latest)
      docker pull algunContainer:1.10
    #+END_SRC

*** Listar containers activos, inactivos
     
     #+BEGIN_SRC sh
       # listar containers en ejecución
       docker ps

       # listar últimos containers creados
       # -a se refiere a "all"
       docker ps -a

       # listar containers activos/en ejecución
       # -l se refiere a "list"
       docker ps -l
     #+END_SRC
       
*** Acceder ó Iniciar/Detener ejecución de containers
    + Para iniciar utilizamos *docker start*
    + Para detener usamos *docker stop*

    #+BEGIN_SRC sh
      # iniciar un container
      docker start algunContainer

      # detener un container en ejecución
      docker stop algunContainer

      # entrar al modo interactivo via terminal
      docker run -it algunContainer

      # docker run -it algunContainer /bin/sh
      # docker run -it algunContainer /bin/bash
    #+END_SRC

*** Versionar containers
     + Suponiendo que ya habiamos creado en la página de *dockerhub* un repositorio llamado *distroalpine*

**** 1. Creamos un tag a nuestro container local

     #+BEGIN_SRC sh
        docker tag a24bb4013296 neverkas/distroalpine:3.12
     #+END_SRC

**** 2. Subimos los cambios
     
     #+BEGIN_SRC sh
        docker push neverkas/distroalpine:3.12
     #+END_SRC


     docker tag local-image:tagname new-repo:tagname
     docker push new-repo:tagname

** Probando con alpine linux

   #+BEGIN_SRC sh
     # https://www.emacswiki.org/emacs/Evil
     # https://orgmode.org/manual/Installation.html

     # corremos el container la version 3.12 (el tag)
     # si no existe lo descarga
     docker run alpine:3.12
     # instalar git
     apk add git
     # instalar emacs
     apk add emacs
     # listar packages (entrar al emacs)
     M-x packages-list
     # instalar org mode (entrar a emacs )
     M-x package-install RET org RET
     # instalar evil mode (tratè con el list-packages pero no aparecìa)
     git clone https://github.com/emacs-evil/evil.git
     mv evil ~/emacs.d/

     # descargar el theme dark dracula
     https://github.com/dracula/emacs.git
     mv /emacs/dracula-theme.el ~/emacs.d/themes/dracula-theme.el
   #+END_SRC

   Agregar lo sig al ~/.emacs para activar el vim mod y el theme dark dracula
   #+BEGIN_SRC emacs-lisp
     ; con esto agregamos el modo vim
     (add-to-list 'load-path "~/.emacs.d/evil")
     (require 'evil)
     (evil-mode 1)

     ; cargamos el theme dracula dark
     (add-to-list 'custom-theme-load-path "~/.emacs.d/themes")
     (load-theme 'dracula t)
   #+END_SRC
   
** Referencias
   + [[https://docs.docker.com/develop/develop-images/dockerfile_best-practices/][Best practices for writing Dockerfiles - docs.docker.com]]
   + [[https://github.com/rocker-org/rocker/wiki/How-to-save-data][How to save data - github.com/rocker-org]]
   + [[https://www.digitalocean.com/community/tutorials/como-instalar-y-usar-docker-en-ubuntu-18-04-1-es][Como instalar y usar Docker en Ubuntu 18.04 - Digitalocean.com]]
   + [[https://www.ionos.es/digitalguide/servidores/configuracion/tutorial-docker-instalacion-y-primeros-pasos/][Tutorial Docker - Instalación y primeros pasos - Ionos.es]]
   + [[https://colorfield.be/blog/cleaning-lando-containers][Cleaning up containers - colorfield.de]]
   + [[https://blog.hipolabs.com/understanding-docker-without-losing-your-shit-cf2b30307c63][Understanding Docker - Blog hipolabs]]
   + [[https://docs.docker.com/engine/reference/commandline/commit/][Docker commit - Docker.com]]

   + [[https://www.youtube.com/watch?v=PbiYll21Jxg&list=PLZdsdjcJ44WU_cY2Y1LFLnmsSjFD5BZLZ][Playlist - DOcker container course (el mejor por ahora)]]
   + [[https://www.youtube.com/watch?v=vjnOIE-CwMU&list=PLqRCtm0kbeHAep1hc7yW-EZQoAJqSTgD-&index=2][Video - DOcker - primeros pasos]]
   + [[https://www.youtube.com/watch?v=6idFknRIOp4&t=201s][Video - Aprender docker en 14min]]

   + https://stackoverflow.com/questions/21871479/docker-cant-connect-to-docker-daemon
   + https://www.digitalocean.com/community/questions/how-to-fix-docker-got-permission-denied-while-trying-to-connect-to-the-docker-daemon-socket
   + https://manjaro.site/how-to-install-docker-on-manjaro-18-0/

** Distribuciones de Linux (Mas actualizado)
*** Actualmente en uso
    Por ahora utilizo ubuntu trusty que sería la versión 14.04 que es bastante liviana
    
    #+BEGIN_SRC sh
      # entramos a la terminal (se creará un nuevo contenedor "distinto" cada vez que ejecutamos este comando)
      # docker run -it ubuntu:trusty bin/bash

      # descargamos la distribución ubuntu versión trusty (14.04)
      docker pull ubuntu:trusty

      # creamos una carpeta en nuestro HOST y la compartimos
      mkdir ~/Docker
      # Hacemos un punto de montaje
      # 1.Para asignar el nombre al contenedor usamos --name
      # 2.Para referirnos al volumen usamos -v
      # 3.La ruta (debe ser absoluta agregando ~) del HOST a compartir será ~/Docker
      #   (si no es absoluta, se creará un volumen que se comparte entre los demás containers, a docker volume)
      # 4.La nueva ruta que se creará en el Container /opt/share
      # 5.La imagen a utilizar es ubuntu:trusty
      # 6.En la bash shell
      # docker run -v ~/Docker:/opt/share -it ubuntu:trusty /bin/bash
      docker run -it --name test1 -v ~/Docker:/opt/share ubuntu:trusty bash

      # IMPORTANTE:
      # Recorda que cada vez que ejecutes "run" se creará un nuevo contenedor
      # en este caso se montará un punto de montaje entre Host/Un nuevo Contenedor llamado "test1"
      # cada vez que quieras hacer cambios en ese "contenedor"
      # acceder con docker exec -it test /bin/bash

      # comprobamos
      docker ps -a | grep test1
      # iniciamos el proceso del container
      docker start test1
      # corremos el comando "modo interactivo" en el container "test1" y accedemos a la bash shell
      # (si usamos run, se creará un nuevo contenedor, la idea es utilizar este y no se creará otro)
      docker exec -it test1 /bin/bash

      apt-get update
      apt-get install swi-prolog -y

      # versionamos para guardar el estado del container
      docker ps -a # para revisar el id del container
      docker commit 5b13ee15d1f1 neverkas/ubuntu-trusty # suponiendo que ese es el ID
      docker push neverkas/ubuntu-trusty

      # revisamos el nuevo contenedor
      docker ps -a

      # salimos del contenedor
      exit
      # si queremos revisar la version de prolog instalada sin entrar al container
      docker exec test1 swipl -v
      # si queremos acceder al container y ejecutar prolog
      docker exec -it test1 swipl
      exit # salimos
      # si queremos acceder solo como en la bash shell
      docker exec -it test1 /bin/bash


      # IMPORTANTE:
      # - Al hacer commit se creará una nueva imagen, que apunta al repositorio publico "neverkas/ubuntu-trusty"
      # el usuario seria neverkas
      # seguido del nombre de container que se guardará como local (sería una imagen)


    #+END_SRC

*** Ubuntu
    Cada versión de la distribución lleva un nombre distinto

    |---------+--------|
    | Version | Nombre |
    |---------+--------|
    |   14.04 | Trusty |
    |   16.04 | Xenial |
    |   18.04 | Bionic |
    |---------+--------|

    *Referencias*
    + [[https://releases.ubuntu.com/][Ubuntu releases - ubuntu.com]]
    + [[https://hub.docker.com/_/ubuntu?tab=tags][Ubuntu Tags - hub.docker.com]]
    + [[https://wwu-pi.github.io/tutorials/lectures/lsp/010_install_swi_prolog.html][Installing SWI-Prolog - pi-github.io]]
** Instalación

   #+NAME: Instalación y Configuración
   #+BEGIN_SRC sh
     sudo pacman -S docker

     # Create the docker group.
     sudo groupadd docker
     # Add your user to the docker group.
     sudo usermod -aG docker ${USER}
     # relogear ò reiniciar

     # verificar si anda
     docker run hello-world
   #+END_SRC

   #+NAME: Versionando Containers
   #+BEGIN_SRC sh
     # para listar imagenes corriendo
     docker ps

     # para correr o descargar && instalar una version ligera de linux con el tag 3.12
     docker run alpine:3.12
     # iniciar en modo "interactivo" en la terminal al contenedor alpine
     docker run -it alpine:3.12 sh
     # para listar archivos de la imagen
     # seguido al nombre del container y del tag, puedo mandarle comandos al container
     docker run alpine:3.12 ls -l

     # muestra los containers instalados
     docker image ls | head
     # muestra los ultimos comandos de todos los containers (y su hash en la 1ra columna para versionar)
     docker ps -a | head

     # comitear un container (suponiendo que copiaste el hash de ps -a)
     docker commit elHashDelContainer
     # podemos verlo (copiamos el id)
     docker image ls | head
     # le asignamos un tag para diferenciar (suponiendo que asdasd123123 es el id)
     docker image tag asdasd123123 miPrimerDocker
   #+END_SRC

