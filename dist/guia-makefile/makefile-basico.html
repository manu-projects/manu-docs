<!--?xml version="1.0" encoding="utf-8"?--><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<!-- 2022-01-18 mar 10:59 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Guia Básica Makefile</title>
<meta name="author" content="jelou">
<meta name="generator" content="Org Mode">
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<link rel="stylesheet" type="text/css" href="/assets/css/style.css">
<link rel="stylesheet" type="text/css" href="/assets/css/sass-style.css">
<script type="text/javascript" src="/assets/js/all.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Guia Básica Makefile</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgaee240d">1. Conceptos</a></li>
<li><a href="#orgbddc0d5">2. Macros/Variables</a>
<ul>
<li><a href="#orgd889927">2.1. Conceptos</a></li>
<li><a href="#org157e97d">2.2. Convenciones de Macros</a>
<ul>
<li><a href="#org4993cd3">2.2.1. Conceptos</a></li>
<li><a href="#org0c874ca">2.2.2. Ejemplo 1 - Sin usar macros</a></li>
<li><a href="#org6d21ceb">2.2.3. Ejemplo 2 - Usando macros</a></li>
<li><a href="#org83e87d9">2.2.4. Ejemplo 3 - Usando macros automáticas</a></li>
</ul>
</li>
<li><a href="#orgf026587">2.3. Macros predefinidas</a>
<ul>
<li><a href="#org696b886">2.3.1. Conceptos</a></li>
<li><a href="#org7b70a84">2.3.2. Ejemplos</a></li>
</ul>
</li>
<li><a href="#org815c504">2.4. Macros automáticas</a>
<ul>
<li><a href="#org88bcca6">2.4.1. Conceptos</a></li>
<li><a href="#org9d86770">2.4.2. Macro ($@) - Obtener target</a></li>
<li><a href="#orgb62ce88">2.4.3. Macro ($&lt;) - Obtener primer dependencia</a></li>
<li><a href="#orgb64826f">2.4.4. Macro ($?) - Obtener las dependencias más recientes/actualizadas</a></li>
<li><a href="#orgea9b064">2.4.5. Macro ($^) - Obtener TODAS las dependencias</a></li>
<li><a href="#orgdf630a7">2.4.6. Macro @(F) y @(D) - Obtener directorio y archivo de un target</a></li>
<li><a href="#org2bc0aed">2.4.7. Macro ($*) - Obtener el valor de un patrón que coincidió (stem)</a></li>
</ul>
</li>
<li><a href="#orgcd2307a">2.5. Macros con comodines</a></li>
<li><a href="#org2dba8b9">2.6. Macros de expansión simple y expansión recursiva</a>
<ul>
<li><a href="#orgbb6be4d">2.6.1. Conceptos</a></li>
<li><a href="#orgd56f8ac">2.6.2. Expansión simple de una macro con el operador :=</a></li>
<li><a href="#org7f35175">2.6.3. Expansión única y recursiva con el operador =</a></li>
</ul>
</li>
<li><a href="#org5d327cf">2.7. Sustitución temporal de cadenas en Macros</a>
<ul>
<li><a href="#orgbc6fa9a">2.7.1. Conceptos</a></li>
<li><a href="#orgc7eaccd">2.7.2. Ejemplo</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgda7f602">3. Target/Objetivo</a>
<ul>
<li><a href="#org47348be">3.1. Conceptos</a></li>
<li><a href="#org613e4ef">3.2. Target Final</a></li>
<li><a href="#org9c9b7c8">3.3. Falso target</a>
<ul>
<li><a href="#org25030d9">3.3.1. Conceptos</a></li>
<li><a href="#orgdd979b9">3.3.2. Ejemplos</a></li>
</ul>
</li>
<li><a href="#org9356a20">3.4. Target Ficticio/Simbólico - Phony</a>
<ul>
<li><a href="#orgd2393ae">3.4.1. Conceptos</a></li>
<li><a href="#org5193dc3">3.4.2. Ejemplos comunes</a></li>
<li><a href="#org2e286d1">3.4.3. Ejemplo 1 - Limpiar archivos compilados</a></li>
<li><a href="#org0d406ad">3.4.4. Ejemplo 2 - Compilar programas</a></li>
<li><a href="#org23fae27">3.4.5. Ejemplo 3 - Subrutinas</a></li>
</ul>
</li>
<li><a href="#orgfb12aef">3.5. Target de Seguimiento</a>
<ul>
<li><a href="#orgb1a65f3">3.5.1. Conceptos</a></li>
<li><a href="#orgab067e9">3.5.2. Ejemplo</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org8bad004">4. Dependencias</a>
<ul>
<li><a href="#org75dc540">4.1. Conceptos</a></li>
<li><a href="#org85d2d99">4.2. Ejemplo</a></li>
</ul>
</li>
<li><a href="#orgf1599c4">5. Comandos/Ordenes/Recipes</a>
<ul>
<li><a href="#orgb8e95df">5.1. Conceptos</a></li>
<li><a href="#orgfe5ba46">5.2. Definir multiples makefiles</a></li>
<li><a href="#org6b3def5">5.3. Ignorar errores de ejecución</a></li>
<li><a href="#org75ea0b5">5.4. No mostrar la linea de la orden</a></li>
<li><a href="#org1782e4a">5.5. Simular ejecución del Makefile</a></li>
</ul>
</li>
<li><a href="#orgdf13136">6. Reglas</a>
<ul>
<li><a href="#org5a78ae3">6.1. Conceptos</a></li>
<li><a href="#org366f4dd">6.2. Reglas Explícitas</a>
<ul>
<li><a href="#org43bc2ea">6.2.1. Conceptos</a></li>
<li><a href="#org0a00185">6.2.2. Ejemplo Básico - Poco eficiente, sin macros automáticas ni reglas implícitas</a></li>
<li><a href="#orge8c5176">6.2.3. Ejemplo - Más Optimo</a></li>
</ul>
</li>
<li><a href="#orge52ed74">6.3. Reglas Implícitas</a>
<ul>
<li><a href="#orgd8b0482">6.3.1. Conceptos</a></li>
<li><a href="#org33b641a">6.3.2. Ejemplo</a></li>
</ul>
</li>
<li><a href="#orgc9a4e97">6.4. Reglas de Patrón - Pattern Rules</a>
<ul>
<li><a href="#orgbb3521e">6.4.1. Conceptos</a></li>
<li><a href="#org6810f29">6.4.2. Ejemplos</a></li>
</ul>
</li>
<li><a href="#orgd4d6a61">6.5. Reglas de Patrón Estáticas</a>
<ul>
<li><a href="#org07f4302">6.5.1. Conceptos</a></li>
<li><a href="#org7a5dc20">6.5.2. Ejemplo</a></li>
</ul>
</li>
<li><a href="#orgea7c740">6.6. Referencias</a>
<ul>
<li><a href="#orgefbb623">6.6.1. Referencias Oficiales</a></li>
<li><a href="#orgbcd6fee">6.6.2. Referencias Extraoficiales</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orge437544">7. Directivas</a>
<ul>
<li><a href="#orga532ce3">7.1. Directiva vpath</a>
<ul>
<li><a href="#orgedb711b">7.1.1. Conceptos</a></li>
<li><a href="#org3ab8d85">7.1.2. Ejemplo</a></li>
</ul>
</li>
<li><a href="#orga242fce">7.2. <span class="todo _WAITING_">[WAITING]</span> Directiva include</a></li>
</ul>
</li>
<li><a href="#org3438ad2">8. Ejemplos prácticos</a>
<ul>
<li><a href="#orgc88a3ff">8.1. Proyecto Simple en C</a></li>
<li><a href="#orga3d22e6">8.2. Proyecto Intermedio en C - Alternativa #1 (file dependency + watch)</a></li>
<li><a href="#org25b4326">8.3. Proyecto Intermedio en C - Alternativa #2 (file dependency + watch)</a></li>
</ul>
</li>
<li><a href="#orga5db37e">9. Ejemplos Interesantes</a>
<ul>
<li><a href="#org85c0f4d">9.1. Expresividad - Lineas muy extensas</a></li>
<li><a href="#org701518b">9.2. Generar varios ejecutables</a></li>
<li><a href="#org7ea5079">9.3. Comandos en Shell diferentes</a></li>
<li><a href="#org7a3d533">9.4. Prioridad entre target y dependencia</a></li>
<li><a href="#org7621352">9.5. Tips para Comandos de Linux</a></li>
</ul>
</li>
<li><a href="#org71d576f">10. Referencias</a>
<ul>
<li><a href="#org81cfd10">10.1. Referencias Oficiales</a></li>
<li><a href="#org7b54cf3">10.2. Referencias Extraoficiales</a></li>
<li><a href="#orgb08283c">10.3. Referencias Issues</a></li>
<li><a href="#org08c0c2c">10.4. Referencias Youtube</a></li>
</ul>
</li>
<li><a href="#org8715973">11. <span class="todo _TODO_">[TODO]</span> Referencias pendientes</a></li>
<li><a href="#org9aa26cb">12. Libros</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgaee240d" class="outline-2">
<h2 id="orgaee240d"><span class="section-number-2">1.</span> Conceptos</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>Se utiliza <code>make</code> para cualquier proyecto con <b>dependencias</b> entre archivos, no solo para compilar programas de C..</li>
<li>En <code>C</code> la relación de dependencia es
<ol class="org-ol">
<li>Los ejecutables dependen de los file objects <code>.o</code></li>
<li>Los file objects <code>.o</code> dependen de su código fuente <code>.c</code> y de los archivos de cabecera <code>.h</code> que incluyan los <code>.c</code></li>
</ol></li>
</ul>

<p>
<b>Observaciones:</b>
</p>
<ul class="org-ul">
<li>Los archivos <code>.o</code> son objetos</li>
<li>Los <code>.h</code> son archivos de cabecera (headers), se incluyen declaraciones de estructuras, variables globales y funciones (prototipos/firmas)</li>
<li>Los <code>.c</code> son archivos fuente, los que tienen la implementación del programa (de las funciones)</li>
</ul>
</div>
</div>
<div id="outline-container-orgbddc0d5" class="outline-2">
<h2 id="orgbddc0d5"><span class="section-number-2">2.</span> Macros/Variables</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgd889927" class="outline-3">
<h3 id="orgd889927"><span class="section-number-3">2.1.</span> Conceptos</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>Las <b>macros</b> ó <b>variables</b> son <b>identificadores</b> que se sustituyen por su valor
(al parsear el archivo <code>Makefile</code>)</li>
<li>Se <b>expanden</b> (sustituyen por su valor) cuando se usa con el <code>$</code> Ej. <code>$(macro)</code></li>
<li>Son sensibles a las mayusculas, y no pueden contener espacios</li>
<li>Se definen al principio del Makefile, si fuesen redefinidas se usará la definición más nueva</li>
</ul>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Definimos 2 macros: PROGRAMA, OBJETOS</span>

<span style="color: #7590db;">PROGRAMA</span> = juego.exe <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&lt;- macro #1</span>

<span style="color: #7590db;">OBJETOS</span> = juego.o jugador.o item.o <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&lt;- macro #2</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Cuando GNU Make lea esta regla, reemplazará las macros por su valor</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">juego.exe : juego.o jugador.o item.o</span>
<span style="color: #2aa1ae; background-color: #292e34;">#   </span><span style="color: #2aa1ae; background-color: #292e34;">gcc -I./include -o juego.exe juego.o jugador.o item.o</span>

<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">PROGRAMA</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJETOS</span><span style="color: #4f97d7;">)</span>
  gcc -I./include -o juego.exe $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJETOS</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">las siguientes reglas tienen lógica repetida y son muy básicas,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">no entramos en detalle porque lo importante en este ejemplo son las MACROS</span>
<span style="color: #bc6ec5; font-weight: bold;">juego.o</span> : juego.c jugador.h item.h
  gcc -I./include -c -o juego.o juego.c

<span style="color: #bc6ec5; font-weight: bold;">jugador.o</span> : jugador.c jugador.h
  gcc -I./include -c -o jugador.o jugador.c

<span style="color: #bc6ec5; font-weight: bold;">item.o</span> : item.c item.h
  gcc -I./include -c -o item.o item.c
</pre>
</div>
</div>
</div>
<div id="outline-container-org157e97d" class="outline-3">
<h3 id="org157e97d"><span class="section-number-3">2.2.</span> Convenciones de Macros</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org4993cd3" class="outline-4">
<h4 id="org4993cd3"><span class="section-number-4">2.2.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
La mayoría de los <code>Makefiles</code> tienden a seguir estas convenciones al crear <b>macros</b>
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-left">

<col class="org-left">

<col class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Nombre</th>
<th scope="col" class="org-left">Expansión</th>
<th scope="col" class="org-left">Descripcion</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">OBJS</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">Representa todos los archivos .o</td>
</tr>

<tr>
<td class="org-left">&nbsp;</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">Nos evita repetir cada .o como dependencia en varias reglas</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">INSTALLDIR</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">Para indicar la ruta donde estará el ejecutable del programa</td>
</tr>

<tr>
<td class="org-left">&nbsp;</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">Se tiende a utilizar en un target <code>INSTALL</code> que creemos</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">INCLUDE</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">Para indicar una o varias rutas de archivos a incluir</td>
</tr>

<tr>
<td class="org-left">&nbsp;</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">(por lo general archivos de cabecera <code>.h</code>)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org0c874ca" class="outline-4">
<h4 id="org0c874ca"><span class="section-number-4">2.2.2.</span> Ejemplo 1 - Sin usar macros</h4>
<div class="outline-text-4" id="text-2-2-2">
<blockquote>
<p>
La ventaja de usar esta macro (podriamos ponerle cualquier otro nombre, es sólo una convención)
es que sólo la nombramos usando el <code>$</code> y listo :)
</p>

<p>
Pero.. si NO la usamos y.. hay muchas reglas que usen los mismos archivos <code>.c</code> habrán reglas redundantes
que repitan dependencias, y en caso que llegase a dejar de usa alguno de los archivos o cambiase
el nombre de alguno de ellos deberiamos modificar uno por uno… :(
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #bc6ec5; font-weight: bold;">juego.exe</span>: juego.c jugadores.c items.c ./include/jugador.h ./include/item.h
  gcc -I./include -o juego.exe juego.c jugador.c item.c
</pre>
</div>
</div>
</div>
<div id="outline-container-org6d21ceb" class="outline-4">
<h4 id="org6d21ceb"><span class="section-number-4">2.2.3.</span> Ejemplo 2 - Usando macros</h4>
<div class="outline-text-4" id="text-2-2-3">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">CC</span> = gcc
<span style="color: #7590db;">CFLAGS</span> = -I./include
<span style="color: #7590db;">PROGRAMA</span> = juego.exe
<span style="color: #7590db;">FUENTES</span> = juego.c jugador.c item.c

<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">PROGRAMA</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">FUENTES</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/jugador.h $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/item.h
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CFLAGS</span><span style="color: #4f97d7;">)</span>  -o $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">PROGRAMA</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">FUENTES</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org83e87d9" class="outline-4">
<h4 id="org83e87d9"><span class="section-number-4">2.2.4.</span> Ejemplo 3 - Usando macros automáticas</h4>
<div class="outline-text-4" id="text-2-2-4">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">CC</span> = gcc
<span style="color: #7590db;">CFLAGS</span> = -I./include
<span style="color: #7590db;">PROGRAMA</span> = juego.exe
<span style="color: #7590db;">FUENTES</span> = juego.c jugador.c item.c

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Macros automáticas</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> para obtener el nombre del objetivo/target</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- $</span><span style="color: #a45bad; background-color: #292e34;">^</span><span style="color: #2aa1ae; background-color: #292e34;"> para obtener todas las dependencias</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Nota: sacamos los .h de las dependencias, para mostrar el $</span><span style="color: #a45bad; background-color: #292e34;">^</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">pero si modificaran los .h, el objetivo no se reconstruiría,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">sólo ocurriría si se modificaran los fuentes (.c)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(en otros ejemplos resolvemos esta problemática)</span>
<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">PROGRAMA</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">FUENTES</span><span style="color: #4f97d7;">)</span>
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CFLAGS</span><span style="color: #4f97d7;">)</span>  -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> $<span style="color: #a45bad;">^</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf026587" class="outline-3">
<h3 id="orgf026587"><span class="section-number-3">2.3.</span> Macros predefinidas</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-org696b886" class="outline-4">
<h4 id="org696b886"><span class="section-number-4">2.3.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-2-3-1">
<ul class="org-ul">
<li>Tienen un valor por defecto, por tanto las definimos en el <b>Makefile</b> le estamos sobreescribiendo el contenido</li>
<li>El compilador <b>gcc</b> se comunica con <b>GNU linker</b> cuando enlaza los objetos (.o) para generar el ejecutable (para más detalles <code>man ld</code>)</li>
<li>La opción <code>-L</code> del flag <code>LDFLAGS</code> se usa de la forma <code>-LrutaDeBibliotecas</code> es decir la ruta va seguido sin espacios (Ej. <code>LDFLAGS=-L/usr/jelou/shared</code>)</li>
<li>La opción <code>-l</code> del flag <code>LDLIBS</code> se usa de la forma <code>-lnombreBiblioteca</code> (Ej. <code>LDLIBS=-lm -lpthread -lcommons</code>)</li>
<li>El flag <code>LDLIBS</code> se debe agregar luego de los <b>archivos fuente</b> (.c), caso contrario el GNU Linker podría no funcionar correctamente</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-left">

<col class="org-left">

<col class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Nombre</th>
<th scope="col" class="org-left">Expansión</th>
<th scope="col" class="org-left">Descripcion</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">MAKE</td>
<td class="org-left">make</td>
<td class="org-left">Programa que gestiona los <code>Makefile</code></td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">LDFLAGS</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">- Flags al <b>enlazador/linker</b> <code>ld</code> (cuando el compilador lo invoca)</td>
</tr>

<tr>
<td class="org-left">&nbsp;</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">- Se usa con la opción <code>-L</code> para indicar la ruta donde encontrar bibliotecas que usará la aplicación</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">LDLIBS</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">- Se usa con la opción <code>-l</code> para indicar los nombres de las bibliotecas que usará</td>
</tr>

<tr>
<td class="org-left">&nbsp;</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">- Se complementa con <code>LDFLAGS</code> porque estas bibliotecas deberían estar en la ruta que se indicó en ese otro FLAG</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">CC</td>
<td class="org-left">gcc</td>
<td class="org-left">Compilador predefinido de C</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">CXX</td>
<td class="org-left">g++</td>
<td class="org-left">Compilador predefinido de C++</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">CFLAGS</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">Flags del compilador de C</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">CPPFLAGS</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">Flags para el pre-procesador de C</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">CXXFLAGS</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">Flags del compilador de C++</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org7b70a84" class="outline-4">
<h4 id="org7b70a84"><span class="section-number-4">2.3.2.</span> Ejemplos</h4>
<div class="outline-text-4" id="text-2-3-2">
<div class="org-src-container">
<pre class="src src-makefile"></pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org815c504" class="outline-3">
<h3 id="org815c504"><span class="section-number-3">2.4.</span> Macros automáticas</h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-org88bcca6" class="outline-4">
<h4 id="org88bcca6"><span class="section-number-4">2.4.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-2-4-1">
<ul class="org-ul">
<li>Las <b>macros automáticas</b> son macros <b>internas</b> cuyo valor depende de la regla que estemos ejecutando.</li>
<li>Estas <b>macros</b> previo a ejecutar un <b>comando</b> evalúan el <b>timestamp</b> del <b>target</b> y de sus <b>dependencias</b></li>
</ul>

<blockquote>
<p>
Para ver algunos de los ejemplos, luego de ejecutar el target <code>init</code> que hicimos para simular un programa
deberemos actualizar los archivos que se creen. Porque estas macros evalúan las <b>dependencias</b>
que sean más recientes que el <b>target</b>.
</p>

<p>
Es decir si tratamos de ejecutarlos luego de usar <code>init</code> puede que en algunos solo diga
"tal archivo está actualizado" y es porque las <b>dependencias</b> tienen la misma fecha/hora de 
modificación que el <b>target</b>.
</p>

<p>
Por tanto.. repito, debemos modificar los archivos, para ver funcionar algunos de los ejemplos,
si no dirá solo el mensaje que dijimos antes.
</p>
</blockquote>

<table id="org5f9dd16" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-left">

<col class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Macro</th>
<th scope="col" class="org-left">Expansión</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">$@</td>
<td class="org-left">Obtiene el <span class="underline">nombre del Target</span> de la regla que se está ejecutando</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">$&lt;</td>
<td class="org-left">Captura la primer dependencia de la regla</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">$?</td>
<td class="org-left">Lista los nombres de las dependencias más recientes que el target, separadas por espacio</td>
</tr>

<tr>
<td class="org-left">&nbsp;</td>
<td class="org-left">(recordemos lo del timestamp más reciente)</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">$^</td>
<td class="org-left">Similar a <code>$?</code> pero lista todas las dependencias, no compara contra el target</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">$*</td>
<td class="org-left">Target con el sufijo eliminado</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org9d86770" class="outline-4">
<h4 id="org9d86770"><span class="section-number-4">2.4.2.</span> Macro ($@) - Obtener target</h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
La macro <code>$@</code> nos permite obtener el nombre del <b>target</b>
</p>
</div>

<ol class="org-ol">
<li><a id="org28d3444"></a>Ejemplo 1 - Crear y nombrar un ejecutable de C<br>
<div class="outline-text-5" id="text-2-4-2-1">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">1. "supongamos" que ya tenemos los targets OBJS, CC, ...</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">2. El -o es un parámetro de gcc para definir el nombre de ejecutable</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">en este caso se llamará "unprograma" osea tal cual al target</span>
<span style="color: #bc6ec5; font-weight: bold;">unprograma</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJS</span><span style="color: #4f97d7;">)</span>
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CFLAGS</span><span style="color: #4f97d7;">)</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJS</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="orgb7af0b7"></a>Ejemplo 2 - Imprimir con el comando echo<br>
<div class="outline-text-5" id="text-2-4-2-2">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- imprimirá por pantalla el nombre del target!</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- el @ antes del echo es para no imprimir el comando echo,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">permite que se imprima solo el mensaje que el echo quiere imprimir</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- el </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> es la MACRO AUTOMATICA :) obtendrá el nombre del target</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">es decir "unprograma"</span>
<span style="color: #bc6ec5; font-weight: bold;">unprograma</span>:
  @echo <span style="color: #2d9574;">"el target se llama: "</span> <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgb62ce88" class="outline-4">
<h4 id="orgb62ce88"><span class="section-number-4">2.4.3.</span> Macro ($&lt;) - Obtener primer dependencia</h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
La macro <code>$&lt;</code> obtiene el primer archivo de dependencia que permitió que se ejecute la regla
(es decir elige la primer <b>dependencia</b>, la que esté más a la izquierda)
</p>
</div>
<ol class="org-ol">
<li><a id="org8fc0ed9"></a>Ejemplo 1 - Imprimir primer dependencia<br>
<div class="outline-text-5" id="text-2-4-3-1">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Siempre va a imprimir el nombe "main.o" porque es la primer dependencia</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- La macro $</span><span style="color: #a45bad; background-color: #292e34;">&lt;</span><span style="color: #2aa1ae; background-color: #292e34;"> elige la primer dependencia que hizo que se ejecutara</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">la regla (la regla está formada por el target+dependencias+comando)</span>
<span style="color: #bc6ec5; font-weight: bold;">unprograma.c</span>: main.o players.o items.o
  @echo $<span style="color: #a45bad;">&lt;</span>
</pre>
</div>
</div>
</li>
<li><a id="org9c8dcd3"></a>Ejemplo 2 - Compilar programa C<br>
<div class="outline-text-5" id="text-2-4-3-2">
<p>
Recordemos que las <b>dependencias</b> van seguido del <b>target</b>,
en este caso se va a compilar un programa que usará sólo el archivo <code>players.c</code>
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Se compilará un archivo llamado "programa.o"</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- La macro $</span><span style="color: #a45bad; background-color: #292e34;">&lt;</span><span style="color: #2aa1ae; background-color: #292e34;"> obtendrá unicamente la primer dependencia (players.c)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- La segunda dependencia (players.h) nunca será usada por $</span><span style="color: #a45bad; background-color: #292e34;">&lt;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- La macro </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> obtiene el nombre del target (programa.o)</span>
<span style="color: #bc6ec5; font-weight: bold;">programa.o</span>: players.c players.h
  gcc -c $<span style="color: #a45bad;">&lt;</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">codigo de abajo no cuenta para el ejemplo</span>
<span style="color: #bc6ec5; font-weight: bold;">init</span>:
  touch players.c players.h

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  -rm *.<span style="color: #4f97d7;">{</span>c,h<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgb64826f" class="outline-4">
<h4 id="orgb64826f"><span class="section-number-4">2.4.4.</span> Macro ($?) - Obtener las dependencias más recientes/actualizadas</h4>
<div class="outline-text-4" id="text-2-4-4">
<p>
La macro <code>$?</code> obtiene la <b>dependencia</b> más reciente/actualizada.
(mas reciente respecto comparado con el target de la regla)
Si recordamos que una dependencia representa un archivo, y tenemos varias dependencias
entonces <code>$?</code> obtendrá el último archivo modificado, el que alteramos recientemente.
</p>

<p>
<b>Observaciones:</b>
</p>
<ul class="org-ul">
<li>La macro <code>$?</code> se <b>expande</b> cuando hay archivos más recientes que el target</li>
<li>Cada vez que compilemos el programa del ejemplo, el <b>timestamp</b> del target se actualizará</li>
</ul>
</div>
<ol class="org-ol">
<li><a id="orgf69256b"></a>Ejemplo 1<br>
<div class="outline-text-5" id="text-2-4-4-1">
<p>
Si modificamos solo dos achivos luego del <code>make init</code> se mostrarán los nombe de esos archivos,
(si cambiaramos el <code>$?</code> por <code>$^</code> mostraría todas las dependencias/archivos)
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- La macro $</span><span style="color: #a45bad; background-color: #292e34;">?</span><span style="color: #2aa1ae; background-color: #292e34;"> obtendrá sólo las dependencias más recientes</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Se intentará compilar un archivo con los últimos .c modificados</span>
<span style="color: #bc6ec5; font-weight: bold;">main.o</span>: main.c players.h players.c
  gcc $<span style="color: #a45bad;">?</span> -c <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span>
  @echo <span style="color: #2d9574;">"Se compilaron los archivos"</span> $<span style="color: #a45bad;">?</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">el codigo de abajo no cuenta para el ejemplo</span>
<span style="color: #bc6ec5; font-weight: bold;">init</span>:
  touch main.o main.c players.c players.h

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  -rm *.<span style="color: #4f97d7;">{</span>c,h<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgea9b064" class="outline-4">
<h4 id="orgea9b064"><span class="section-number-4">2.4.5.</span> Macro ($^) - Obtener TODAS las dependencias</h4>
<div class="outline-text-4" id="text-2-4-5">
<p>
La macro <code>$^</code> obtiene todas las dependencias, no le interesa si fue la más reciente o no
</p>
</div>
<ol class="org-ol">
<li><a id="org05764d1"></a>Ejemplo 1<br>
<div class="outline-text-5" id="text-2-4-5-1">
<p>
Si modificamos solo dos archivos luego del <code>make init</code> se mostrarán todos los nombre de los archivos,
no solo los recientemente modificados. 
Si queremos sólo los más recientes respecto al <b>target</b> debemos usar la macro <code>$?</code>
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- La macro $</span><span style="color: #a45bad; background-color: #292e34;">^</span><span style="color: #2aa1ae; background-color: #292e34;"> obtendrá todas las dependencias</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Se intentará compilar un archivo todos los .c y .h</span>
<span style="color: #bc6ec5; font-weight: bold;">main.o</span>: main.c players.h players.c
  gcc $<span style="color: #a45bad;">^</span> -c <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span>
  @echo <span style="color: #2d9574;">"Se compilaron los archivos"</span> $<span style="color: #a45bad;">^</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">el codigo de abajo no cuenta para el ejemplo</span>
<span style="color: #bc6ec5; font-weight: bold;">init</span>:
  touch main.o main.c players.c players.h

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  -rm *.<span style="color: #4f97d7;">{</span>c,h<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgdf630a7" class="outline-4">
<h4 id="orgdf630a7"><span class="section-number-4">2.4.6.</span> Macro @(F) y @(D) - Obtener directorio y archivo de un target</h4>
<div class="outline-text-4" id="text-2-4-6">
</div>
<ol class="org-ol">
<li><a id="org0dd10c0"></a>Ejemplo<br>
<div class="outline-text-5" id="text-2-4-6-1">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #bc6ec5; font-weight: bold;">ho/player/player.o</span>: player/items.c player/account.c
  @echo <span style="color: #2d9574;">"Carpeta:"</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">@D</span><span style="color: #4f97d7;">)</span>
  @echo <span style="color: #2d9574;">"Archivo:"</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">@F</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">el codigo de abajo no cuenta para el ejemplo</span>
<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: init
<span style="color: #bc6ec5; font-weight: bold;">init</span>: crearDirectorios crearArchivos
  @echo <span style="color: #2d9574;">"Terminamos de ejecutar las dependencias :)"</span>

<span style="color: #bc6ec5; font-weight: bold;">crearArchivos</span>:
  touch player/items.c player/account.c
<span style="color: #bc6ec5; font-weight: bold;">crearDirectorios</span>:
  mkdir player

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  -rm player/*.<span style="color: #4f97d7;">{</span>c,o<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org2bc0aed" class="outline-4">
<h4 id="org2bc0aed"><span class="section-number-4">2.4.7.</span> Macro ($*) - Obtener el valor de un patrón que coincidió (stem)</h4>
<div class="outline-text-4" id="text-2-4-7">
<ul class="org-ul">
<li>Es el valor del objetivo que concide con el <b>patrón de objetivo</b></li>
</ul>

<blockquote>
<p>
Por ejemplo si el objetivo es <code>player.c</code> y el <b>patrón de objetivo</b> es <code>%.c</code>
entonces la cadena <code>player</code> es la que obtiene la macro <code>$*</code>
</p>
</blockquote>
</div>
</div>
</div>
<div id="outline-container-orgcd2307a" class="outline-3">
<h3 id="orgcd2307a"><span class="section-number-3">2.5.</span> Macros con comodines</h3>
</div>
<div id="outline-container-org2dba8b9" class="outline-3">
<h3 id="org2dba8b9"><span class="section-number-3">2.6.</span> Macros de expansión simple y expansión recursiva</h3>
<div class="outline-text-3" id="text-2-6">
</div>
<div id="outline-container-orgbb6be4d" class="outline-4">
<h4 id="orgbb6be4d"><span class="section-number-4">2.6.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-2-6-1">
<ul class="org-ul">
<li>Las <b>macros</b> NO siempre se <b>expanden</b> en el momento de <b>asignación</b></li>
<li>Algunas macros se <b>expanden</b> cuando son usadas en alguna <b>reglas</b></li>
</ul>
</div>
</div>
<div id="outline-container-orgd56f8ac" class="outline-4">
<h4 id="orgd56f8ac"><span class="section-number-4">2.6.2.</span> Expansión simple de una macro con el operador :=</h4>
<div class="outline-text-4" id="text-2-6-2">
<ul class="org-ul">
<li>Si usamos el operador <code>:=</code> consideramos que la expansión de la macro será simple</li>
<li>En una expansión simple, <b>la asignación del valor a la macro/variable es inmediata</b></li>
<li><p>
"Podríamos" asociarlo con el término de <b>expansión ansiosa</b>
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">la asignación del valor "-O -Wall" a la macro "CFLAGS" es inmediata</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">lo mismo para "CC"</span>
<span style="color: #7590db;">CFLAGS</span> := -O -Wall
<span style="color: #7590db;">CC</span> := gcc

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">OJO..! esta quizás no sería una buena decisión..</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">porque las macros automáticas </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> y </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">*</span><span style="color: #2aa1ae; background-color: #292e34;"> aún no tienen valor..</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">hasta que se usen en alguna regla y le asocie un valor</span>
<span style="color: #7590db;">DEPFLAGS</span> := -MT <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> -MMD -MP -MF <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.d

<span style="color: #bc6ec5; font-weight: bold;">programa.exe</span>: main.o
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CFLAGS</span><span style="color: #4f97d7;">)</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span>

<span style="color: #bc6ec5; font-weight: bold;">%.o</span>: %.c %.d
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DEPFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CFLAGS</span><span style="color: #4f97d7;">)</span> -c <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.c -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span>
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org7f35175" class="outline-4">
<h4 id="org7f35175"><span class="section-number-4">2.6.3.</span> Expansión única y recursiva con el operador =</h4>
<div class="outline-text-4" id="text-2-6-3">
<ul class="org-ul">
<li>Si usamos el operador <code>=</code> consideramos que la expansión de la macro será <b>recursiva</b></li>
<li>En una expansión recursiva, <b>la asignación del valor se realiza cuando la macro es usada</b></li>
<li>La macro se expande una única vez durante tiempo de ejecución</li>
<li><p>
"Podríamos" asociarlo con el término de <b>expansión perezosa</b> (no es inmediata, se dará cuando se evalúe la macro)
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">UNO</span>  = $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">ESE</span><span style="color: #4f97d7;">)</span>  <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">acá no se expande la macro "ESE"</span>
<span style="color: #7590db;">ESE</span>  = $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OTRO</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">acá tampoco se expande la macro "OTRO"</span>
<span style="color: #7590db;">OTRO</span> = Pepito

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">las macros se expanden en este momento, con la evaluación de la regla</span>
<span style="color: #bc6ec5; font-weight: bold;">culpable</span>:
  @echo $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">UNO</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">acá se expanden las macros recursivas</span>
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org5d327cf" class="outline-3">
<h3 id="org5d327cf"><span class="section-number-3">2.7.</span> Sustitución temporal de cadenas en Macros</h3>
<div class="outline-text-3" id="text-2-7">
</div>
<div id="outline-container-orgbc6fa9a" class="outline-4">
<h4 id="orgbc6fa9a"><span class="section-number-4">2.7.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-2-7-1">
<ul class="org-ul">
<li>Para sustituir una cadena de una macro de <b>forma temporal</b> usamos la sig. sintáxis <code>$(nombreMacro:textoAsociado=nuevoTexto)</code></li>
<li>Otra alternativa a <code>$(nombreMacro:textoAsociado=nuevoTexto)</code> sería usar la función <b>patsubst</b> <code>$(patsubst textoAsociado, nuevoTexto, nombreMacro)</code></li>
<li>Se utiliza para cambiar la extensión de los archivos que tiene asociado una macro (Ej. <code>$(OBJ:.o=.c)</code> para reemplazar .o por .c)</li>
</ul>
</div>
</div>
<div id="outline-container-orgc7eaccd" class="outline-4">
<h4 id="orgc7eaccd"><span class="section-number-4">2.7.2.</span> Ejemplo</h4>
<div class="outline-text-4" id="text-2-7-2">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">INCLUDE</span> := ./include
<span style="color: #7590db;">OBJ</span> := game.o player.o item.o

<span style="color: #bc6ec5; font-weight: bold;">game.exe</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span><span style="color: #4f97d7;">)</span>
  gcc -o game.exe $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- temporalmente reemplazamos la extensión .o por .c de los archivos</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">que están asociados a la macro OBJ</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- podríamos simplemente agregarlo en una macro SRC = $(</span><span style="color: #7590db; background-color: #292e34;">OBJ</span><span style="color: #2aa1ae; background-color: #292e34;">:.o=.c)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">pero lo dejamos así para que se sobreentienda su uso</span>
<span style="color: #bc6ec5; font-weight: bold;">game.o</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span>:<span style="color: #7590db;">.o</span>=.c<span style="color: #4f97d7;">)</span>
  gcc -I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span> -c -o game.o $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span>:<span style="color: #7590db;">.o</span>=.c<span style="color: #4f97d7;">)</span>

<span style="color: #bc6ec5; font-weight: bold;">player.o</span>: player.c $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/player.h
  gcc -I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span> -c -o player.o player.c

<span style="color: #bc6ec5; font-weight: bold;">item.o</span>: item.c $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/item.h
  gcc -I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span> -c -o item.o item.c
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgda7f602" class="outline-2">
<h2 id="orgda7f602"><span class="section-number-2">3.</span> Target/Objetivo</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org47348be" class="outline-3">
<h3 id="org47348be"><span class="section-number-3">3.1.</span> Conceptos</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>Cada <b>target</b> representa el nombre del archivo que se generará, luego de cumplirse la regla</li>
<li>El <b>target</b> se actualiza si alguna de las dependencias fue actualizada (<i>make compara el timestamp de los headers de los archivos</i>)</li>
<li>Si make detecta que el target está desactualizado respecto de sus dependencias =&gt; se ejecutará la regla</li>
</ul>
</div>
</div>
<div id="outline-container-org613e4ef" class="outline-3">
<h3 id="org613e4ef"><span class="section-number-3">3.2.</span> Target Final</h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>Es la primera regla del makefile y tiende a ser el ejecutable</li>
<li>Es el último <b>target</b> en el <b>árbol de dependencias</b> por tanto el último que se ejecuta</li>
<li>Se lo suele llamar <code>all</code></li>
</ul>
</div>
</div>
<div id="outline-container-org9c9b7c8" class="outline-3">
<h3 id="org9c9b7c8"><span class="section-number-3">3.3.</span> Falso target</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-org25030d9" class="outline-4">
<h4 id="org25030d9"><span class="section-number-4">3.3.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-3-3-1">
<ul class="org-ul">
<li>No se les suele agregar <a href="#org8bad004">Dependencias</a></li>
<li>Cuando queremos que la regla se ejecute siempre (<i>evitamos que compare el timestamp del target y las dependencias</i>)</li>
<li>Es un target que no existe (<i>porque un target tiende a representar un archivo físico que persiste en disco</i>)</li>
<li>Make nota que no aparece el archivo en las entradas del directorio donde esté el Makefile, entonces ejecuta los comandos que generan la regla</li>
</ul>

<blockquote>
<p>
Un posible problema sería si agregamos un <b>falso target</b> y en el directorio existe un 
fichero con ese nombre.
</p>

<p>
Porque al no tener <b>dependencias</b> el <code>make</code> interpretará que el archivo está actualizado,
y no ejecutará los <b>comandos</b> de la <b>regla</b>
</p>

<p>
La solución a esto es utilizar <code>PHONY</code> (representa a un <b>target ficticio</b>)
</p>
</blockquote>
</div>
</div>
<div id="outline-container-orgdd979b9" class="outline-4">
<h4 id="orgdd979b9"><span class="section-number-4">3.3.2.</span> Ejemplos</h4>
<div class="outline-text-4" id="text-3-3-2">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">este es un ejemplo típico de un "falso target", que borra los archivos .o de fichero c compilado</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- porque "clean" no es un archivo en si (no debería)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- la regla tampoco tiene dependencia (lo que se agrega seguido de los dos puntos)</span>
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  rm *.o

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Podemos usar .PHONY</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">para evitar problemas si llegase a existir un archivo "clean"</span>
<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  rm *.o
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org9356a20" class="outline-3">
<h3 id="org9356a20"><span class="section-number-3">3.4.</span> Target Ficticio/Simbólico - Phony</h3>
<div class="outline-text-3" id="text-3-4">
</div>
<div id="outline-container-orgd2393ae" class="outline-4">
<h4 id="orgd2393ae"><span class="section-number-4">3.4.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-3-4-1">
<ul class="org-ul">
<li>Soluciona el problema de los <b>falsos target</b> (<i>que exista un archivo con el mismo nombre del target</i>)</li>
<li>Se antepone <code>.PHONY</code> previo a definir una regla, seguido al nombre del <b>falso target</b> (Ej. <code>.PHONY: all</code>)</li>
<li>Los casos comunes son <code>.PHONY: all clean</code></li>
</ul>

<p>
<b>Observación:</b>
</p>
<ul class="org-ul">
<li>A diferencia de un target común, en uno con <code>.PHONY</code> el comando de la regla se ejecutará antes que la dependencia</li>
<li>En un target común, cuando se cumple la regla (se ejecutan todas las dependencias) =&gt; luego el comando asociado</li>
</ul>

<blockquote>
<p>
Cuando a un <b>falso target</b> le agregamos como dependencia otro <b>falso target</b>
la regla siempre se cumple. Por tanto podemos usar los <b>falsos targets</b>
como subrutinas a ejecutar.
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org5193dc3" class="outline-4">
<h4 id="org5193dc3"><span class="section-number-4">3.4.2.</span> Ejemplos comunes</h4>
<div class="outline-text-4" id="text-3-4-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-left">

<col class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Target</th>
<th scope="col" class="org-left">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">all</td>
<td class="org-left">Ejecuta todas las tareas de la aplicación (Ej. clean, check, install, …)</td>
</tr>

<tr>
<td class="org-left">install</td>
<td class="org-left">Crea una instalación a partir de binarios</td>
</tr>

<tr>
<td class="org-left">clean</td>
<td class="org-left">Borra todos los archivos binarios</td>
</tr>

<tr>
<td class="org-left">check</td>
<td class="org-left">Ejecutar tests asociados a la aplicación</td>
</tr>

<tr>
<td class="org-left">info</td>
<td class="org-left">Generar documentación a partir del código fuente de la app</td>
</tr>

<tr>
<td class="org-left">ctags</td>
<td class="org-left">Imprimir las firmas de las funciones implementadas</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org2e286d1" class="outline-4">
<h4 id="org2e286d1"><span class="section-number-4">3.4.3.</span> Ejemplo 1 - Limpiar archivos compilados</h4>
<div class="outline-text-4" id="text-3-4-3">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Si usamos .PHONY</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">evitamos problemas si llegase a existir un archivo "clean"</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(osea que un fichero con el mismo nombre que el "falso target")</span>
<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  rm *.o
</pre>
</div>
</div>
</div>
<div id="outline-container-org0d406ad" class="outline-4">
<h4 id="org0d406ad"><span class="section-number-4">3.4.4.</span> Ejemplo 2 - Compilar programas</h4>
<div class="outline-text-4" id="text-3-4-4">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: all
<span style="color: #bc6ec5; font-weight: bold;">all</span>: programa1, programa2

<span style="color: #bc6ec5; font-weight: bold;">programa1</span>: main.o archivo1.o archivo2.o
  gcc -o programa1 main.o archivo1.o archivo2.o

<span style="color: #bc6ec5; font-weight: bold;">programa2</span>: main.o archivo1.o archivo3.o
  gcc -o programa2 main.o archivo1.o archivo3.o
</pre>
</div>
</div>
</div>
<div id="outline-container-org23fae27" class="outline-4">
<h4 id="org23fae27"><span class="section-number-4">3.4.5.</span> Ejemplo 3 - Subrutinas</h4>
<div class="outline-text-4" id="text-3-4-5">
<p>
Este ejemplo lo podemos ejecutar con <code>makefile cleanall</code>
donde se ejecutarán las subrutinas de borrar los archivos de tipo object
y luego los de texto
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: cleanall cleanobj cleantxt
<span style="color: #bc6ec5; font-weight: bold;">cleanall</span>: cleanobj cleantxt
  rm miprograma

<span style="color: #bc6ec5; font-weight: bold;">cleanobj</span>:
  rm *.o

<span style="color: #bc6ec5; font-weight: bold;">cleantxt</span>:
  rm *.txt
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgfb12aef" class="outline-3">
<h3 id="orgfb12aef"><span class="section-number-3">3.5.</span> Target de Seguimiento</h3>
<div class="outline-text-3" id="text-3-5">
</div>
<div id="outline-container-orgb1a65f3" class="outline-4">
<h4 id="orgb1a65f3"><span class="section-number-4">3.5.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-3-5-1">
<ul class="org-ul">
<li>Para marcar el último momento en el que se produjo un evento</li>
<li>Útiles cuando en una regla usamos comandos que sólo generan que no generan efecto, como sería el devolver un output (Ej. cat, echo, printf, …)</li>
<li>Consiste en crear un archivo vacío (el target) del que sólo se usa su <b>timestamp</b> de creación</li>
<li>Para obtener los archivos modificados más recientes (<i>los compara contra el target</i>) y usar sus nombres con algún comando que no genere efecto</li>
<li>El <code>$?</code> se <b>expande</b> por las <b>dependencias</b> (osea archivos) cuyo <b>timestamp</b> sea más reciente que <b>target</b></li>
</ul>
</div>
</div>
<div id="outline-container-orgab067e9" class="outline-4">
<h4 id="orgab067e9"><span class="section-number-4">3.5.2.</span> Ejemplo</h4>
<div class="outline-text-4" id="text-3-5-2">
<blockquote>
<p>
Suponiendo que ya habiamos creado los archivos main.c, jugadores.c, items.c
</p>

<p>
Primero ejecutamos <code>make imprime_actualizados</code> y se construirá el ejecutable imprime<sub>actualizados</sub>
</p>

<p>
Si modificamos alguno de los .c y volvemos a ejecutar el comando anterior,
se ejecutará el <code>cat nombreArchivo</code> de los modificados recientemente
y se volverá a crear el ejecutable imprime<sub>actualizados</sub> con <code>touch imprime_actualizados</code>
(este ejecutable no tiene información útil, sólo la fecha del último archivo actualizado en su header)
</p>
</blockquote>

<p>
<b>Observación:</b>
En este ejemplo el <code>$?</code> se expande por los archivos más recientes que <code>imprime_actualizados</code>
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Si no crearamos el archivo con "touch",</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">el target estaría siempre desactualizado,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">porque "cat" y "echo" no generan efecto, sólo devuelven un output no crean un archivo,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">por lo cual $</span><span style="color: #a45bad; background-color: #292e34;">?</span><span style="color: #2aa1ae; background-color: #292e34;"> compararía contra un target outdate (desactualizado)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- con "cat" imprimimos contenido de un archivo</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- el $</span><span style="color: #a45bad; background-color: #292e34;">?</span><span style="color: #2aa1ae; background-color: #292e34;"> se expande con los archivos de timestamp mas reciente que imprime_actualizados</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- imprimimos el contenido de los archivos actualizados/modificados</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">es decir su timestamp es más reciente que el del archivo imprime_actualizados</span>
<span style="color: #bc6ec5; font-weight: bold;">imprime_actualizados</span>: main.c jugadores.c items.c
  cat $<span style="color: #a45bad;">?</span>
  touch imprime_actualizados

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Otro ejemplo..</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Podemos ver los nombres de los archivos .c actualizados recientemente,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">creamos el cfiles_actualizados</span>
<span style="color: #bc6ec5; font-weight: bold;">cfiles_actualizados</span>: *.<span style="color: #4f97d7;">[</span>c<span style="color: #4f97d7;">]</span>
  @echo $<span style="color: #a45bad;">?</span>
  touch cfiles_actualizados
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org8bad004" class="outline-2">
<h2 id="org8bad004"><span class="section-number-2">4.</span> Dependencias</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org75dc540" class="outline-3">
<h3 id="org75dc540"><span class="section-number-3">4.1.</span> Conceptos</h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li>Cada <b>dependencia</b> representa un archivo (si no existe, make busca una regla donde aparezca como target y cree esa dependencia)</li>
<li>Las <b>dependencias</b> son archivos que son requisitos para cumplir ó construir un target/objetivo
(<i>Ej.: juegito: jugador.c items.c jugador.h items.h, los archivos .c y .h serían dependencias para el target juegito</i>)</li>
<li>GNU Make compara el <b>timestamp</b> de creación/modificación entre las dependencias y el objetivo/target</li>
<li>Si el <b>timestamp</b> de alguna de dependencia es más moderno que el objetivo/target entonces
<ol class="org-ol">
<li>Esa dependencia fue actualizada/modificada, y se volverá a construir el objetivo</li>
<li>Se ejecuta la orden/es asociado a la regla para construir el objetivo</li>
</ol></li>
</ul>
</div>
</div>
<div id="outline-container-org85d2d99" class="outline-3">
<h3 id="org85d2d99"><span class="section-number-3">4.2.</span> Ejemplo</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Este ejemplo no tiene macros automáticas ($</span><span style="color: #a45bad; background-color: #292e34;">?</span><span style="color: #2aa1ae; background-color: #292e34;">, $</span><span style="color: #a45bad; background-color: #292e34;">&lt;</span><span style="color: #2aa1ae; background-color: #292e34;">, ...)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">tampoco predefinidas (CC, CFLAGS, ...), ni funciones (wildcad, patsubst, ...)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">es lo más simple posible para entender las dependencias</span>

<span style="color: #bc6ec5; font-weight: bold;">calculadora.exe</span>: calculadora.o operaciones.o lib.o
  gcc calculadora.o operaciones.o lib.o -o calculadora.exe

<span style="color: #bc6ec5; font-weight: bold;">calculadora.o</span>: calculadora.c ./include/operaciones.h ./include/lib.h
  gcc -I./include -c calculadora.c -o calculadora.o

<span style="color: #bc6ec5; font-weight: bold;">operaciones.o</span>: operaciones.c ./include/operaciones.h
  gcc -I./include -c operaciones.c -o operaciones.o

<span style="color: #bc6ec5; font-weight: bold;">lib.o</span>: lib.c ./include/lib.h
  gcc -I./include -c lib.c -o lib.o
</pre>
</div>


<div id="org130e6e6" class="figure">
<p><img src="/img/makefile-dependencias.png" alt="makefile-dependencias.png">
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf1599c4" class="outline-2">
<h2 id="orgf1599c4"><span class="section-number-2">5.</span> Comandos/Ordenes/Recipes</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgb8e95df" class="outline-3">
<h3 id="orgb8e95df"><span class="section-number-3">5.1.</span> Conceptos</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>Los <b>comandos</b> se ejecutan cuando se cumple la <b>regla</b></li>
<li>Deben estar identados con <b>tabs</b> (<i>si nos olvidamos, habrán errores</i>)</li>
</ul>
</div>
</div>
<div id="outline-container-orgfe5ba46" class="outline-3">
<h3 id="orgfe5ba46"><span class="section-number-3">5.2.</span> Definir multiples makefiles</h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li>Por lo general se suele tener sólo un archivo <code>Makefile</code> y se ejecuta con <code>make</code></li>
<li>Si el nombre no es <code>Makefile</code> podemos usar <code>make -f nombreDelMakefile</code></li>
<li>Si tenemos varios makefiles podemos seguir el estándar de agregarles la extensión <code>.mk</code></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">suponiendo que tenemos un segundo makefile</span>
make -f build.mk

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">la otra alternativa es</span>
make --file=build.mk
</pre>
</div>
</div>
</div>
<div id="outline-container-org6b3def5" class="outline-3">
<h3 id="org6b3def5"><span class="section-number-3">5.3.</span> Ignorar errores de ejecución</h3>
<div class="outline-text-3" id="text-5-3">
<ul class="org-ul">
<li>Usamos el prefijo <code>-</code> previo a declarar el comando en una regla (Ej. <code>-rm *.c</code> en vez de <code>rm *.c</code>)</li>
<li>Si usamos <code>-comando</code> y alguna iteración de éste falla, seguirá ejecutando el resto de instancias</li>
</ul>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">este era el caso típico que solíamos hacer</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">si por algún motivo falla el rm, no continúa borrando</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(Ej. no encuentra algún archivo .o)</span>
<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  rm *.o

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">SOLUCION HERE..!</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Si falla el rm por mismos motivos que el de arriba</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">no importa, seguirá ejecutandose borrando los que falten</span>
<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  -rm *.o <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">acá estamos agregando el guión.. :)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org75ea0b5" class="outline-3">
<h3 id="org75ea0b5"><span class="section-number-3">5.4.</span> No mostrar la linea de la orden</h3>
<div class="outline-text-3" id="text-5-4">
<ul class="org-ul">
<li>Usamos el prefijo <code>@</code> previo a declarar el comando en una regla (Ej. <code>@echo hola mundo</code> en vez de <code>echo hola mundo</code>)</li>
<li>Se suele utilizar al imprimir mensajes cuando usamos el comando <code>echo</code> para evitar que make imprima el comando+mensaje</li>
</ul>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- esto sólo imprimira en la shell un "hola mundo"</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- si no anteponemos el arroba, lo hará dos veces</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">y la primera será con el comando echo seguido del string</span>
<span style="color: #bc6ec5; font-weight: bold;">programa</span>:
  @echo hola mundo
</pre>
</div>
</div>
</div>
<div id="outline-container-org1782e4a" class="outline-3">
<h3 id="org1782e4a"><span class="section-number-3">5.5.</span> Simular ejecución del Makefile</h3>
<div class="outline-text-3" id="text-5-5">
<ul class="org-ul">
<li>Si ejecutamos <code>make -n</code> ó <code>make --just-print</code> =&gt; simulará la ejecución, imprimiendo los mensajes del Makefile</li>
</ul>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">ejecutamos el makefile</span>
make -n <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">don't forget el parámetro -n</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">esto imprimiría la terminal, simulando que se ejecuta el makefile</span>
gcc -c jugadores.c
gcc -c main.c
gcc -o programa main.o jugadores.o
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdf13136" class="outline-2">
<h2 id="orgdf13136"><span class="section-number-2">6.</span> Reglas</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org5a78ae3" class="outline-3">
<h3 id="org5a78ae3"><span class="section-number-3">6.1.</span> Conceptos</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li>Si una regla tiene una dependencia no existe =&gt; GNU Make buscará una regla que la cree (osea que esté como objetivo/target)</li>
<li>Si una regla tiene archivos en las <a href="#org8bad004">Dependencias</a> que además son <a href="#orgda7f602">Target/Objetivo</a> de otras reglas, entonces
<ol class="org-ol">
<li>Primero se ejecuta la regla donde aparece como <code>target</code></li>
<li>Luego la regla donde aparece como <code>dependencia</code></li>
</ol></li>
</ul>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">La forma general de cada regla es de la forma</span>
<span style="color: #bc6ec5; font-weight: bold;">target</span>: dependencias
  comando1
  comando2
</pre>
</div>
</div>
</div>
<div id="outline-container-org366f4dd" class="outline-3">
<h3 id="org366f4dd"><span class="section-number-3">6.2.</span> Reglas Explícitas</h3>
<div class="outline-text-3" id="text-6-2">
</div>
<div id="outline-container-org43bc2ea" class="outline-4">
<h4 id="org43bc2ea"><span class="section-number-4">6.2.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-6-2-1">
<ul class="org-ul">
<li>En las <b>reglas explícitas</b> le indicamos a GNU Make como construir el objetivo/target agregandole una ó varias <b>ordenes</b> que ejecutará</li>
<li>La <b>orden</b> que agregamos para que se construya el objetivo/target se ejecutará luego que las dependencias se ejecuten ó bien se construyan</li>
</ul>
</div>
</div>
<div id="outline-container-org0a00185" class="outline-4">
<h4 id="org0a00185"><span class="section-number-4">6.2.2.</span> Ejemplo Básico - Poco eficiente, sin macros automáticas ni reglas implícitas</h4>
<div class="outline-text-4" id="text-6-2-2">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">En este ejemplo, no estamos usando macro automáticas ni tampoco reglas implícitas,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">lo que implíca que tengamos un Makefile poco configurable, y no óptimo.</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Porque si agregaramos nuevos .c ó .h ó incluso si cambiaramos los nombre de estos,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">también deberíamos modificar este Makefile... Si lo llevamos a un proyecto más grande,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">con muchos archivos sería dificil de mantener, y poco extensible.. Existiría un gran</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">nivel de acoplamiento entre el proyecto y este Makefile</span>

<span style="color: #7590db;">PROGRAMA</span> = calculadora <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">nombre del ejecutable</span>
<span style="color: #7590db;">CC</span> = gcc <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">compilador de c</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">esta macro lo usaremos con el flag -I de gcc</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">con -I podemos indicar la ruta de los .h que usan los .c</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">si no indicamos la ruta al compilador gcc, éste fallará y no sabrá donde encontrar los .h</span>
<span style="color: #7590db;">INCLUDE</span> = ./include

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">se podría hacer más genérico si usaramos wildcards + la función patsubst</span>
<span style="color: #7590db;">OBJ</span> = calculadora.o operaciones.o lib.o

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- primero se ejecutan las dependencias, osea se espera que se construyan los archivos .o</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- cuando las dependencias terminen, se ejecuta la orden que se agregó explícitamente</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- la orden es opcional, GNU Make la agrega implícitamente (ya sabe que la debería agregar)</span>
<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">PROGRAMA</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span><span style="color: #4f97d7;">)</span>
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> -o $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">PROGRAMA</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">siempre que alguna de las dependencias calculadora.c ó operaciones.h sea modificada,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">entonces se volverá a construir el objetivo (en este caso es el archivo calculadora.o),</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- podríamos optimizar la regla y quedara más genérica, si usaramos las macros automáticas como </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> y $</span><span style="color: #a45bad; background-color: #292e34;">^</span>
<span style="color: #bc6ec5; font-weight: bold;">calculadora.o</span> : calculadora.c $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/operaciones.h
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> -I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span> -c -o calculadora.o  calculadora.c

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- se repite la misma situación que con la regla que tiene como objetivo/target a calculadora.o</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">pero las dependencias cambian, y también los parámetros a gcc</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- podríamos optimizar la regla y quedara más genérica, si usaramos las macros automáticas como </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> y $</span><span style="color: #a45bad; background-color: #292e34;">^</span>
<span style="color: #bc6ec5; font-weight: bold;">operaciones.o</span> : operaciones.c $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/operaciones.h $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/lib.h
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> -I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span> -c -o operaciones.o operaciones.c

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- se repite la misma situación que con la regla que tiene como objetivo/target a calculadora.o</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">pero las dependencias cambian, y también los parámetros a gcc</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- podríamos optimizar la regla y quedara más genérica, si usaramos las macros automáticas como </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> y $</span><span style="color: #a45bad; background-color: #292e34;">^</span>
<span style="color: #bc6ec5; font-weight: bold;">lib.o</span> : lib.c $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/lib.h
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> -I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span> -c -o lib.o lib.c

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">--------------------------------------------------</span>

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  @-rm *.o
  @-rm $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">PROGRAMA</span><span style="color: #4f97d7;">)</span>

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: run
<span style="color: #bc6ec5; font-weight: bold;">run</span>: ; @./$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">PROGRAMA</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orge8c5176" class="outline-4">
<h4 id="orge8c5176"><span class="section-number-4">6.2.3.</span> Ejemplo - Más Optimo</h4>
<div class="outline-text-4" id="text-6-2-3">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">PROGRAMA</span> = calculadora.exe
<span style="color: #7590db;">CC</span> = gcc
<span style="color: #7590db;">CFLAGS</span> = -I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">para que el compilador gcc sepa donde encontrar los .h</span>
<span style="color: #7590db;">INCLUDE</span> = ./include

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">SRC = calculadora.c operaciones.c lib.c</span>
<span style="color: #7590db;">SRC</span> = $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">wildcard</span> *.c<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">obtiene todos los archivo fuente .c</span>
<span style="color: #7590db;">OBJ</span> = $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">SRC</span>:<span style="color: #7590db;">.c</span>=.o<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">reemplazamos la extensión de los archivos .c a .o de la macro SRC</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">-----------------------------------------------------------------</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(1) REGLA EXPLÍCITA</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Esta es una Regla Explícita, porque le indicamos a GNU Make</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">como debe construir el objetivo "calculadora.exe"</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">con la orden "$(</span><span style="color: #7590db; background-color: #292e34;">CC</span><span style="color: #2aa1ae; background-color: #292e34;">) $(</span><span style="color: #7590db; background-color: #292e34;">CFLAGS</span><span style="color: #2aa1ae; background-color: #292e34;">) -o </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> $</span><span style="color: #a45bad; background-color: #292e34;">^</span><span style="color: #2aa1ae; background-color: #292e34;">"</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- El objetivo es construir el binario "calculadora.exe"</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Las dependencias son los archivos .o</span>
<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">PROGRAMA</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span><span style="color: #4f97d7;">)</span>
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> $<span style="color: #a45bad;">^</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">-----------------------------------------------------------------</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(1) REGLA IMPLÍCITA</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- La siguiente es una Regla Implícita, y hace lo mismo que la regla explícita anterior,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">funciona porque GNU Make entiende que implícitamente debe agregar la orden</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">que usabamos antes "$(</span><span style="color: #7590db; background-color: #292e34;">CC</span><span style="color: #2aa1ae; background-color: #292e34;">) -o </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> $</span><span style="color: #a45bad; background-color: #292e34;">^</span><span style="color: #2aa1ae; background-color: #292e34;">"</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Usar ésta ó la otra forma, pero no ambas, porque no tendría sentido</span>

<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">PROGRAMA</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span><span style="color: #4f97d7;">)</span>
<span style="color: #2aa1ae; background-color: #292e34;">#  </span><span style="color: #2aa1ae; background-color: #292e34;">$(</span><span style="color: #7590db; background-color: #292e34;">CC</span><span style="color: #2aa1ae; background-color: #292e34;">) -o </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> $</span><span style="color: #a45bad; background-color: #292e34;">^</span><span style="color: #2aa1ae; background-color: #292e34;"> # &lt;- lo comentamos porque como dijimos más arriba, no sería necesario</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">-----------------------------------------------------------------</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(3) REGLAS IMPLÍCITAS</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Estas otras también son reglas implícitas,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">porque no tienen una orden que le diga a GNU Make como debe construir los objetivos</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- En este caso los objetivos a construir son los archivos .o,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">y las dependencias son los archivos de cabecera .h que necesitan</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Podríamos no agregar estas reglas, e igual compilaría el programa calculadora.exe</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">pero son necesarias si queremos que los objetivos sean reconstruidos</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">en caso que alguna de sus dependencias (los .h) son actualizadas</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Ej.</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Si no tuvieramos estas reglas, e hicieramos cambios en operaciones.h ó lib.h,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">entonces GNU Make al leer la regla "$(</span><span style="color: #7590db; background-color: #292e34;">PROGRAMA</span><span style="color: #2aa1ae; background-color: #292e34;">): $(</span><span style="color: #7590db; background-color: #292e34;">OBJ</span><span style="color: #2aa1ae; background-color: #292e34;">)" (ó bien si quisieramos dejar su forma explícita)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">dirá que el objetivo "calculadora.exe" ya está actualizado, y no volverá a construirlo</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">porque las dependencias .o de esa regla no actualizarían,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">y el timestamp del objetivo y esas dependencias estarían el mismo...</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">en cambio si agregamos estas reglas, e hicieramos cambios en operaciones.h ó lib.h,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">entonces GNU Make volvería a construir los archivos .o (que en estas reglas son objetivos/target)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">y en la regla "$(</span><span style="color: #7590db; background-color: #292e34;">PROGRAMA</span><span style="color: #2aa1ae; background-color: #292e34;">): $(</span><span style="color: #7590db; background-color: #292e34;">OBJ</span><span style="color: #2aa1ae; background-color: #292e34;">)" el objetivo $(</span><span style="color: #7590db; background-color: #292e34;">PROGRAMA</span><span style="color: #2aa1ae; background-color: #292e34;">) estaría desactualizado</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(por comparar el timestamp de modificación del objetivo y sus dependencias),</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">por tanto volvería a construirlo también</span>
<span style="color: #bc6ec5; font-weight: bold;">calculadora.o</span>: operaciones.h

<span style="color: #bc6ec5; font-weight: bold;">operaciones.o</span>: operaciones.h lib.h

<span style="color: #bc6ec5; font-weight: bold;">lib.o</span>: lib.h
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge52ed74" class="outline-3">
<h3 id="orge52ed74"><span class="section-number-3">6.3.</span> Reglas Implícitas</h3>
<div class="outline-text-3" id="text-6-3">
</div>
<div id="outline-container-orgd8b0482" class="outline-4">
<h4 id="orgd8b0482"><span class="section-number-4">6.3.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-6-3-1">
<ul class="org-ul">
<li>En las <b>reglas implícitas</b> es el Makefile quien debe interpretar como construir el objetivo/target</li>
<li>Utiliza el concepto de <b>implicit pattern rules</b> (patrón de reglas implícitas)</li>
</ul>
</div>
</div>
<div id="outline-container-org33b641a" class="outline-4">
<h4 id="org33b641a"><span class="section-number-4">6.3.2.</span> Ejemplo</h4>
<div class="outline-text-4" id="text-6-3-2">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">PROGRAMA</span> = calculadora
<span style="color: #7590db;">CC</span> = gcc
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">no interesa si la macro "INCLUDE" se define antes ó después de CFLAGS,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">porque el valor de ésta se asigna a la macro CFLAGS cuando se ejecute la orden de regla en donde se use CFLAGS</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">GNU Make lee bottom-up</span>
<span style="color: #7590db;">CFLAGS</span> = -I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>
<span style="color: #7590db;">INCLUDE</span> = ./include

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">SRC = calculadora.c operaciones.c lib.c</span>
<span style="color: #7590db;">SRC</span> = $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">wildcard</span> *.c<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">buscará en el directorio todas las entradas/archivos que tengan como extensión .c</span>
<span style="color: #7590db;">OBJ</span> = $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">SRC</span>:<span style="color: #7590db;">.c</span>=.o<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">reemplazamos los .c en .o, otra alternativa sería usar la función patsubst de make</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(1) Regla Explícita</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Indicamos a GNU Make como debe construir el objetivo "calculadora"</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">1. Agregamos las dependencias (los archivos que necesita para generar el objetivo)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">2. Definimos la orden (la sentencia donde compilamos con gcc)</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Nota: Esta regla explícita, podría ser implícita porque podriamos borrar la orden "$(</span><span style="color: #7590db; background-color: #292e34;">CC</span><span style="color: #2aa1ae; background-color: #292e34;">) -o </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> $</span><span style="color: #a45bad; background-color: #292e34;">^</span><span style="color: #2aa1ae; background-color: #292e34;">"</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">y de igual manera GNU Make sabría como interpretar la regla, y que debe agregar por defecto la orden anterior</span>
<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">PROGRAMA</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span><span style="color: #4f97d7;">)</span>
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> $<span style="color: #a45bad;">^</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(3) Reglas implícitas</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Son implícitas, porque no le indicamos a GNU Make como construir el objetivo (en este caso los archivos .o)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">es decir no tienen una orden/comando.. Estan formadas por target+dependencias</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- En estas reglas los objetos (.o) son objetivos/target, le agregamos dependencias (en este caso archivos cabecera .h de los que dependen)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Las definimos para que si algún archivo de cabecera (.h) se actualiza,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">entonces GNU Make entienda que debe reconstruir los objetivos (en este caso archivos .o) que dependen de esos archivos .h</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Ej. si se actualiza operaciones.h, entonces make volverá a construir los objetivos operaciones.o y calculadora.o pero no lib.o</span>
<span style="color: #bc6ec5; font-weight: bold;">calculadora.o</span> : $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/operaciones.h
<span style="color: #bc6ec5; font-weight: bold;">operaciones.o</span> : $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/operaciones.h $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/lib.h
<span style="color: #bc6ec5; font-weight: bold;">lib.o</span> : $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/lib.h

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">--------------------------------------------------</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Agregamos el @ para que no se imprima el comando en la terminal</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Usamos el - para que en caso de fallar la instrucción "rm", se siga ejecutando</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(si no lo usamos, fallará porque no exista algún .o ó el binario y no borrará el resto de los archivos)</span>
<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  @-rm *.o
  @-rm $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">PROGRAMA</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Usamos el ; porque para cumplir este objetivo no se requiere dependencias</span>
<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: run
<span style="color: #bc6ec5; font-weight: bold;">run</span>: ; @./$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">PROGRAMA</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc9a4e97" class="outline-3">
<h3 id="orgc9a4e97"><span class="section-number-3">6.4.</span> Reglas de Patrón - Pattern Rules</h3>
<div class="outline-text-3" id="text-6-4">
</div>
<div id="outline-container-orgbb3521e" class="outline-4">
<h4 id="orgbb3521e"><span class="section-number-4">6.4.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-6-4-1">
<ul class="org-ul">
<li>Una <b>regla de patrón</b> difiere de una regla común, en que el objetivo/target a construir contiene el caracter <code>%</code> (sólo uno)</li>
<li>El símbolo <code>%</code> puede representar uno ó varios caracteres cualquiera, para formar el nombre de un archivo con una extensión específica (Ej. %.c, %.h, etc)</li>
<li>Una <b>regla implícita de patrón</b> se puede aplicar a cualquier objetivo/target que coincida/matchee con su patrón (y las dependencias que matcheen deben existir)</li>
</ul>

<blockquote>
<p>
El <code>%</code> se usa de la forma <code>%.extensionObjetivo : %.extensionDependencias</code>
donde los archivos que son <b>dependencia</b> se usarán para construir el objetivo/target,
pudiendo haber varias dependencias con <code>%</code>
</p>

<p>
Por ejemplo <code>%.o : %.c comun.h</code> en esa regla de patrón
</p>
<ul class="org-ul">
<li>el objetivo/target a construir son archivos con extensión .o (objetos)</li>
<li>las dependencias (archivos .c que deben existir) que coincidan con el patrón del objetivo (fichero .o) se usarán para construir el objetivo</li>
<li>podríamos agregar como rutina <code>gcc -c $&lt; -o $@</code> para construir los objetos a partir de los .c y el archivo comun.h</li>
<li>se construirá el objetivo siempre que se actualicen las dependencias (gnu make compara el timestamp del target/objetivo y sus dependencias)</li>
</ul>
</blockquote>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">OBJ</span> = main.o player.o item.o

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(3) reglas implícitas</span>
<span style="color: #bc6ec5; font-weight: bold;">game.exe</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span><span style="color: #4f97d7;">)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">al escribir estas dos reglas implícitas, estamos reescribiendo la regla de patrón implícita</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">para cuando GNU Make tenga que construir los objetivos player.o e item.o</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">sepa que debe agregar como dependencia esos archivos .h</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(otra opción sería agregar a la regla de patrón la dependencia %.h, y esto no sería necesario</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">aunque también debería existir el archivo main.h)</span>
<span style="color: #bc6ec5; font-weight: bold;">player.o</span>: ./include/player.h
<span style="color: #bc6ec5; font-weight: bold;">item.o</span>: ./include/item.h

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- estas otras 3 reglas implícitas no serían necesarias,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">ya que lo hace la regla de patrón implícita, para cualquier objetivo .o</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">main.o: main.c</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">player.o: player.c</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">item.o: item.c</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">REGLA DE PATRÓN</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- En realidad es una regla de patrón implícita,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">porque GNU Make ya sabe que debe hacer esto.. para construir objetivos .o</span>
<span style="color: #bc6ec5; font-weight: bold;">%.o</span> : %.c
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> -I./include -c $<span style="color: #a45bad;">&lt;</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org6810f29" class="outline-4">
<h4 id="org6810f29"><span class="section-number-4">6.4.2.</span> Ejemplos</h4>
<div class="outline-text-4" id="text-6-4-2">
</div>
<ol class="org-ol">
<li><a id="org379620d"></a>Ejemplo 1 - Regla Explícita de Patrón Vs Regla Implícita De Patrón<br>
<div class="outline-text-5" id="text-6-4-2-1">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">MD_FILES</span> = $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">wildcard</span> *.md<span style="color: #4f97d7;">)</span>
<span style="color: #7590db;">HTML_FILES</span> = $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">MD_FILES</span>:<span style="color: #7590db;">.md</span>=.html<span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">REGLA EXPLICITA DE PATRON que podría ser REGLA IMPLICITA DE PATRON</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">1. Es una regla de patrón por tener el símbolo % que actúa como el asterisco en una regex</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">2. Es una regla explícita porque explícitamente le estamos indicando la orden/comando "$(</span><span style="color: #7590db; background-color: #292e34;">CC</span><span style="color: #2aa1ae; background-color: #292e34;">) -o </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> $</span><span style="color: #a45bad; background-color: #292e34;">&lt;</span><span style="color: #2aa1ae; background-color: #292e34;">"</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">para que GNU Make entienda como construir un objetivo .o a partir de archivos fuente .c</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(en el siguiente parrafo aclaramos porque podría no ser necesario agregar dicha orden)</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">3. Podría ser una regla implícita porque GNU Make ya sabe como construir archivos .o a mediante ficheros .c</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">e implícitamente aplica la orden que pusimos "$(</span><span style="color: #7590db; background-color: #292e34;">CC</span><span style="color: #2aa1ae; background-color: #292e34;">) -o </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> $</span><span style="color: #a45bad; background-color: #292e34;">&lt;</span><span style="color: #2aa1ae; background-color: #292e34;">"</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">por tanto podríamos remover ese comando quedando sólo "%.o:%.c"</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">4. El motivo para que esta orden sea una Regla Explícita, sería si quisieramos redefinir</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">la manera en que GNU Make debe construir el objetivo</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">(Ej. con alguna configuración adicional que no contemplan las macros predefinidas CC, CFLAGS, ...)</span>
<span style="color: #bc6ec5; font-weight: bold;">%.o</span> : %.c
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> $<span style="color: #a45bad;">&lt;</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">----------------------------------------------------------</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">REGLA EXPLICITA DE PATRON &lt;- Arrojará error, porque el patrón del objetivo no coincide con la regla</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">En este ejemplo la regla DEBE ser explícita, porque GNU Make no podría agregar implícitamente</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">la orden "pandoc --to html5 -o </span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">@</span><span style="color: #2aa1ae; background-color: #292e34;"> $</span><span style="color: #a45bad; background-color: #292e34;">&lt;</span><span style="color: #2aa1ae; background-color: #292e34;">" para crear un .html a partir de un .md</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- El patrón del objetivo/target a construir es .md=.html</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- La regla de patrón %.html:%.org NO coincide/matchea con el patrón del objetivo .md=html</span>
<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">HTML_FILES</span><span style="color: #4f97d7; font-weight: bold;">)</span>:%.html:%.org
  pandoc --to html5 -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> $<span style="color: #a45bad;">&lt;</span>
</pre>
</div>
</div>
</li>
<li><a id="org343ceee"></a>Ejemplo 2 - Convertir archivos org-mode a html<br>
<div class="outline-text-5" id="text-6-4-2-2">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">ORG_FILES</span> = $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">wildcard</span> *.org<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">obtenemos los archivos .org de la ruta en donde esté el makefile</span>
<span style="color: #7590db;">HTML_FILES</span> = $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">ORG_FILES</span>:<span style="color: #7590db;">.org</span>=.html<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">reemplazamos la extensión, sólo reemplaza una parte del string</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">otra manera sería usando la función patsubst</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">HTML_FILES = $(</span><span style="color: #7590db; background-color: #292e34;">patsubst</span><span style="color: #2aa1ae; background-color: #292e34;"> %.org, %.html, $(</span><span style="color: #7590db; background-color: #292e34;">ORG_FILES</span><span style="color: #2aa1ae; background-color: #292e34;">))</span>

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: all
<span style="color: #bc6ec5; font-weight: bold;">all</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">HTML_FILES</span><span style="color: #4f97d7;">)</span>
<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">HTML_FILES</span><span style="color: #4f97d7; font-weight: bold;">)</span>: %.html: %.org <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">la regla de patrón debe coincidir con el valor del target cuando éste se va expandiendo</span>
  @echo <span style="color: #2d9574;">"Convirtiendo con pandoc el $</span><span style="color: #a45bad;">&lt;</span><span style="color: #2d9574;"> a </span><span style="color: #2d9574; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span><span style="color: #2d9574;">"</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">simulamos que hacemos la conversión del archivo .org a .html</span>
</pre>
</div>
</div>
</li>
<li><a id="orgd608868"></a>Ejemplo 3 - Compilar código fuente C en objetos<br>
<div class="outline-text-5" id="text-6-4-2-3">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">el % reemplaza cualquier caracter</span>
<span style="color: #bc6ec5; font-weight: bold;">%.o</span>: %.c
  $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> -c $<span style="color: #a45bad;">&lt;</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orgd4d6a61" class="outline-3">
<h3 id="orgd4d6a61"><span class="section-number-3">6.5.</span> Reglas de Patrón Estáticas</h3>
<div class="outline-text-3" id="text-6-5">
</div>
<div id="outline-container-org07f4302" class="outline-4">
<h4 id="org07f4302"><span class="section-number-4">6.5.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-6-5-1">
<ul class="org-ul">
<li>Una <b>Regla de Patrón Estática</b> es una <b>regla de patrón</b> a la que le agregamos un target donde se debe aplicar la regla</li>
</ul>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">La sintáxis regla de patrón estática es:</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">objetivos: patron_objetivo: patron_dependencias</span>
<span style="color: #2aa1ae; background-color: #292e34;">#   </span><span style="color: #2aa1ae; background-color: #292e34;">ordenes</span>

<span style="color: #7590db;">OBJ</span> = calculadora.o operaciones.o

<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">OBJ</span><span style="color: #4f97d7; font-weight: bold;">)</span>: %.o: %.c $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/%.h
  gcc -I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span> -c $<span style="color: #a45bad;">&lt;</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span>
  @echo <span style="color: #2d9574;">"target=</span><span style="color: #2d9574; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span><span style="color: #2d9574;"> , primer dependencia=$</span><span style="color: #a45bad;">&lt;</span><span style="color: #2d9574;">"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org7a5dc20" class="outline-4">
<h4 id="org7a5dc20"><span class="section-number-4">6.5.2.</span> Ejemplo</h4>
<div class="outline-text-4" id="text-6-5-2">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">INCLUDE</span> = ./include
<span style="color: #7590db;">OBJ</span> = calculadora.o operaciones.o

<span style="color: #bc6ec5; font-weight: bold;">calculadora</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span><span style="color: #4f97d7;">)</span>
  <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">esta orden la agrega de forma implícita GNU Make, por tanto es opcional agregarla</span>
  gcc -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> $<span style="color: #a45bad;">^</span>
  @echo <span style="color: #2d9574;">"target=</span><span style="color: #2d9574; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span><span style="color: #2d9574;"> , dependencias=$</span><span style="color: #a45bad;">^</span><span style="color: #2d9574;">"</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">reescribimos la regla de patrón estática pero para el objetivo "calculadora.o",</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">le agregamos una nueva dependencia lib.h para que se reconstruya calculadora.o</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">en caso de que se actualice el archivo de cabecera lib.h</span>
<span style="color: #bc6ec5; font-weight: bold;">calculadora.o</span>: ./include/lib.h

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">no sería necesario escribir esta regla, ya la genera nueva regla de patrón estática</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">operaciones.o: operaciones.c ./include/operaciones.h</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">REGLA DE PATRON ESTATICA</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- Esta regla de patron estática sólo aplica para las dependencias calculadora.c, calculadora.h,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">operaciones.c y operaciones.h. Todas esas archivos deben existir, caso contrario GNU Make dirá</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">que no pudo encontrar alguna de ellas.</span>
<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">OBJ</span><span style="color: #4f97d7; font-weight: bold;">)</span>: %.o: %.c $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/%.h
  <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">esta orden la agrega de forma implícita GNU Make, por tanto es opcional agregarla</span>
  gcc -I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span> -c $<span style="color: #a45bad;">&lt;</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span>
  @echo <span style="color: #2d9574;">"target=</span><span style="color: #2d9574; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span><span style="color: #2d9574;"> , primer dependencia=$</span><span style="color: #a45bad;">&lt;</span><span style="color: #2d9574;">"</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">GNU Make interpretará la anterior regla de patrón estática de la sig. manera:</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">calculadora.o: calculadora.c ./include/calculadora.h ./include/lib.h &lt;-- aparece lib.h xq reescribimos la regla para calculadora.o</span>
<span style="color: #2aa1ae; background-color: #292e34;">#   </span><span style="color: #2aa1ae; background-color: #292e34;">gcc -I./include -c calculadora.c -o calculadora.o</span>
<span style="color: #2aa1ae; background-color: #292e34;">#   </span><span style="color: #2aa1ae; background-color: #292e34;">@echo "target=calculadora.o , primer dependencia=calculadora.c"</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">operaciones.o: operaciones.c ./include/operaciones.h</span>
<span style="color: #2aa1ae; background-color: #292e34;">#   </span><span style="color: #2aa1ae; background-color: #292e34;">gcc -I./include -c operaciones.c -o operaciones.o</span>
<span style="color: #2aa1ae; background-color: #292e34;">#   </span><span style="color: #2aa1ae; background-color: #292e34;">@echo "target=operaciones.o , primer dependencia=operaciones.c"</span>

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">---------------------------------------------------------------------------------------------</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Si a la anterior regla de patrón estática le sacaramos el target $(</span><span style="color: #7590db; background-color: #292e34;">OBJ</span><span style="color: #2aa1ae; background-color: #292e34;">) quedando solo %.o : %.c %.h</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">entonces quedaría una regla de patrón simple, y aplicaría para cualquier .c que coincida con el patrón del objetivo .o</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Ej.</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Supongamos que también estaba el archivo fuente funciones.c y sus respectivo archivo de cabecera funciones.h</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">entonces esta regla de patrón sin el $(</span><span style="color: #7590db; background-color: #292e34;">OBJ</span><span style="color: #2aa1ae; background-color: #292e34;">) haria que GNU Make lo interprete como hacía con calculadora.o y operaciones.o</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">funciones.o: funciones.c ./include/funciones.h</span>
<span style="color: #2aa1ae; background-color: #292e34;">#   </span><span style="color: #2aa1ae; background-color: #292e34;">gcc -o funciones.o funciones.c</span>
<span style="color: #2aa1ae; background-color: #292e34;">#   </span><span style="color: #2aa1ae; background-color: #292e34;">@echo "target=funciones.o , primer dependencia=funciones.c"</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgea7c740" class="outline-3">
<h3 id="orgea7c740"><span class="section-number-3">6.6.</span> Referencias</h3>
<div class="outline-text-3" id="text-6-6">
</div>
<div id="outline-container-orgefbb623" class="outline-4">
<h4 id="orgefbb623"><span class="section-number-4">6.6.1.</span> Referencias Oficiales</h4>
<div class="outline-text-4" id="text-6-6-1">
<ol class="org-ol">
<li><a href="https://www.gnu.org/software/make/manual/make.html#Implicit-Variables">Introduction to Pattern Rules (gnu.org)</a></li>
</ol>
</div>
</div>
<div id="outline-container-orgbcd6fee" class="outline-4">
<h4 id="orgbcd6fee"><span class="section-number-4">6.6.2.</span> Referencias Extraoficiales</h4>
<div class="outline-text-4" id="text-6-6-2">
<ol class="org-ol">
<li><a href="https://www.it.uc3m.es/~pedmume/asignaturas/2005/LAO/Lab2/tutorial4/node6.html">Macros, reglas implícitas, directivas condicionales (it.uc3m.es)</a></li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-orge437544" class="outline-2">
<h2 id="orge437544"><span class="section-number-2">7.</span> Directivas</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orga532ce3" class="outline-3">
<h3 id="orga532ce3"><span class="section-number-3">7.1.</span> Directiva vpath</h3>
<div class="outline-text-3" id="text-7-1">
</div>
<div id="outline-container-orgedb711b" class="outline-4">
<h4 id="orgedb711b"><span class="section-number-4">7.1.1.</span> Conceptos</h4>
<div class="outline-text-4" id="text-7-1-1">
<ul class="org-ul">
<li>Con <code>vpath</code> le indicamos a make donde buscar/encontrar un archivo de una lista de dependencias de una regla</li>
<li>Su uso es <code>vpath patrón ruta</code> (Un patrón podría ser <code>*.c</code> para los source files, ó <code>*.h</code> para los headers)</li>
<li>Nos evita indicar las rutas en las dependencias
(Ej. <code>player.o: player.c player.h</code> en vez de  <code>player.o: src/player.c include/player.h</code></li>
<li>Un ejemplo común para un programa de C, es indicarle la ruta para encontrar los <b>source files</b> o <b>headers</b></li>
</ul>

<blockquote>
<p>
The VPATH variable consists of a list of directories to search when make needs a file
make will search each directory for any file it needs. If a file of
the same name exists in multiple places in the VPATH list, make grabs the first one.
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org3ab8d85" class="outline-4">
<h4 id="org3ab8d85"><span class="section-number-4">7.1.2.</span> Ejemplo</h4>
</div>
</div>
<div id="outline-container-orga242fce" class="outline-3">
<h3 id="orga242fce"><span class="section-number-3">7.2.</span> <span class="todo _WAITING_">[WAITING]</span> Directiva include</h3>
</div>
</div>
<div id="outline-container-org3438ad2" class="outline-2">
<h2 id="org3438ad2"><span class="section-number-2">8.</span> Ejemplos prácticos</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orgc88a3ff" class="outline-3">
<h3 id="orgc88a3ff"><span class="section-number-3">8.1.</span> Proyecto Simple en C</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">MAKE</span> += -f commons-v3.mk <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">le cambiamos el nombre de nuestro makefile</span>
<span style="color: #7590db;">RM</span> = rm -rfv

<span style="color: #7590db;">DIR_BIN</span> = bin
<span style="color: #7590db;">DIR_SRC</span> = src
<span style="color: #7590db;">DIR_OBJ</span> = obj
<span style="color: #7590db;">SRC</span> = $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">wildcard</span> $<span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #bc6ec5;">)</span>/*.c<span style="color: #4f97d7;">)</span>
<span style="color: #7590db;">OBJ</span> = $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">SRC</span>:<span style="color: #7590db;">$</span><span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #bc6ec5;">)</span><span style="color: #7590db;">/%.c</span>=$<span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #bc6ec5;">)</span>/%.o<span style="color: #4f97d7;">)</span>
<span style="color: #7590db;">BIN</span> = app.out

<span style="color: #7590db;">CC</span>=gcc
<span style="color: #7590db;">CFLAGS</span>=-g <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">-Wall #-Wextra</span>
<span style="color: #7590db;">INCLUDE</span>=./include
<span style="color: #7590db;">CPPFLAGS</span>=-I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">le avisamos al pre-procesador de C donde encontrar los archivos de cabecera .h</span>
<span style="color: #7590db;">LDFLAGS</span>=-L/usr/include <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">gcc le indica al GNU linker la ruta donde buscar bibliotecas</span>
<span style="color: #7590db;">LDLIBS</span>=-lpthread -lcommons <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">gcc le indica al GNU linker que bibliotecas usar (agregar luego de los source files)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">--------------------------------------------------------------------</span>

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: all
<span style="color: #bc6ec5; font-weight: bold;">all</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_BIN</span><span style="color: #4f97d7;">)</span>/$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">BIN</span><span style="color: #4f97d7;">)</span>

<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">DIR_BIN</span><span style="color: #4f97d7; font-weight: bold;">)</span><span style="color: #bc6ec5; font-weight: bold;">/$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">BIN</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span><span style="color: #4f97d7;">)</span>
  @echo <span style="color: #2d9574;">"Enlazamos los objetos ("</span>$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">notdir</span> $<span style="color: #a45bad;">^</span><span style="color: #4f97d7;">)</span><span style="color: #2d9574;">") para crear el ejecutable"</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">notdir</span> <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span><span style="color: #4f97d7;">)</span> en $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">dir</span> <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span><span style="color: #4f97d7;">)</span>
  @$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">LDFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #a45bad;">^</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">LDLIBS</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- tiene la DESVENTAJA que sólo estamos viendo 1 archivo de cabecera por .h</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Ej. player.c tendrá player.h, pero y si también tiene item.h y otro.h</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">entonces player.o debería de crearse nuevamente...</span>
<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">OBJ</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #4f97d7;">)</span>/%.o: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #4f97d7;">)</span>/%.c $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span>/%.h
  @echo <span style="color: #2d9574;">"Compilamos el archivo fuente ("</span>$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">notdir</span> $<span style="color: #a45bad;">&lt;</span><span style="color: #4f97d7;">)</span><span style="color: #2d9574;">") en objeto en"</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">dir</span> $<span style="color: #a45bad;">&lt;</span><span style="color: #4f97d7;">)</span>
  @$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CPPFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CFLAGS</span><span style="color: #4f97d7;">)</span> -c $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.c -o $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.o

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">--------------------------------------------------------------------</span>

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  @echo <span style="color: #2d9574;">"Removiendo archivos ejecutables y objetos existentes"</span>
  @-$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">RM</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_BIN</span><span style="color: #4f97d7;">)</span>/*.out
  @-$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">RM</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #4f97d7;">)</span>/*.o

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: run
<span style="color: #bc6ec5; font-weight: bold;">run</span>: ; @-$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_BIN</span><span style="color: #4f97d7;">)</span>/$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">BIN</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga3d22e6" class="outline-3">
<h3 id="orga3d22e6"><span class="section-number-3">8.2.</span> Proyecto Intermedio en C - Alternativa #1 (file dependency + watch)</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">MAKE</span> += -f commons-v3.mk <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">le cambiamos el nombre de nuestro makefile</span>
<span style="color: #7590db;">RM</span> = rm -rfv

<span style="color: #7590db;">DIR_DEP</span> := .dep
<span style="color: #7590db;">DIR_BIN</span> := bin
<span style="color: #7590db;">DIR_SRC</span> := src
<span style="color: #7590db;">DIR_OBJ</span> := .obj
<span style="color: #7590db;">DIRS</span> := $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_BIN</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #4f97d7;">)</span>
<span style="color: #7590db;">SRC</span> := $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">wildcard</span> $<span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #bc6ec5;">)</span>/*.c<span style="color: #4f97d7;">)</span>
<span style="color: #7590db;">DEP</span> := $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">SRC</span>:<span style="color: #7590db;">$</span><span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #bc6ec5;">)</span><span style="color: #7590db;">/%.c</span>=$<span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #bc6ec5;">)</span>/%.d<span style="color: #4f97d7;">)</span>
<span style="color: #7590db;">OBJ</span> := $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">SRC</span>:<span style="color: #7590db;">$</span><span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #bc6ec5;">)</span><span style="color: #7590db;">/%.c</span>=$<span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #bc6ec5;">)</span>/%.o<span style="color: #4f97d7;">)</span>
<span style="color: #7590db;">BIN</span> := app.out

<span style="color: #7590db;">CC</span> := gcc
<span style="color: #7590db;">CFLAGS</span> := -g <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">-Wall #-Wextra</span>
<span style="color: #7590db;">INCLUDE</span> :=./include
<span style="color: #7590db;">CPPFLAGS</span> :=-I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">le avisamos al pre-procesador de C donde encontrar los archivos de cabecera .h</span>
<span style="color: #7590db;">LDFLAGS</span> := -L/usr/include <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">gcc le indica al GNU linker la ruta donde buscar bibliotecas</span>
<span style="color: #7590db;">LDLIBS</span> := -lpthread -lcommons <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">gcc le indica al GNU linker que bibliotecas usar (agregar luego de los source files)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Ojo..! Estamos usando el operador "=" en vez de ":="</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">porque queremos que expansión de la macro sea recursiva (la asignación se dará más adelante, cuando se use en una regla)</span>
<span style="color: #7590db;">DEPFLAGS</span> = -MT <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> -MMD -MP -MF $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.tmp.d

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: all
<span style="color: #bc6ec5; font-weight: bold;">all</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIRS</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_BIN</span><span style="color: #4f97d7;">)</span>/$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">BIN</span><span style="color: #4f97d7;">)</span>

<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">DIRS</span><span style="color: #4f97d7; font-weight: bold;">)</span>: ; @mkdir -p <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span>

<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">DIR_BIN</span><span style="color: #4f97d7; font-weight: bold;">)</span><span style="color: #bc6ec5; font-weight: bold;">/$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">BIN</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span><span style="color: #4f97d7;">)</span>
  @echo <span style="color: #2d9574;">"Enlazamos los objetos ("</span>$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">notdir</span> $<span style="color: #a45bad;">^</span><span style="color: #4f97d7;">)</span><span style="color: #2d9574;">") para crear el ejecutable ($(</span><span style="color: #7590db;">notdir</span><span style="color: #2d9574;"> </span><span style="color: #2d9574; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span><span style="color: #2d9574;">)) en $(</span><span style="color: #7590db;">dir</span><span style="color: #2d9574;"> </span><span style="color: #2d9574; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span><span style="color: #2d9574;">)"</span>
  @$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">LDFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #a45bad;">^</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">LDLIBS</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">esta otra solución hace lo mismo que la de abajo toda comentada al parecer, pero esta anda ok</span>
<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">OBJ</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #4f97d7;">)</span>/%.o: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #4f97d7;">)</span>/%.c $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/%.d | $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>
  @echo <span style="color: #2d9574;">"Se modificó el archivo ($</span><span style="color: #a45bad;">?</span><span style="color: #2d9574;">)"</span>
  @echo -e <span style="color: #2d9574;">"Compilamos el archivo fuente ($(</span><span style="color: #7590db;">notdir</span><span style="color: #2d9574;"> $</span><span style="color: #a45bad;">&lt;</span><span style="color: #2d9574;">)) en objeto en $(</span><span style="color: #7590db;">dir</span><span style="color: #2d9574;"> </span><span style="color: #2d9574; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span><span style="color: #2d9574;">)\n"</span>
  @$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DEPFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CPPFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CFLAGS</span><span style="color: #4f97d7;">)</span> -c $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.c -o $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.o
  @mv -f $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.tmp.d $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.d &amp;&amp; touch <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">se ejecuta si no hubo error de compilación</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">se sugiere que la directiva "include" esté luego de la definición de la macro que se usa como target,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">ó mejor aún al final del Makefile</span>
<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">DEP</span><span style="color: #4f97d7; font-weight: bold;">)</span>:
<span style="color: #4f97d7; font-weight: bold;">include</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">wildcard</span> $<span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DEP</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">--------------------------------------------------------------------</span>

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  @echo <span style="color: #2d9574;">"Removiendo ejecutable, objetos y dependencias"</span>
  @-$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">RM</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_BIN</span><span style="color: #4f97d7;">)</span>/*.out
  @-$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">RM</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #4f97d7;">)</span>/*.o
  @-$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">RM</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/*<span style="color: #4f97d7;">{</span>.d,.tmp.d<span style="color: #4f97d7;">}</span>

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: run
<span style="color: #bc6ec5; font-weight: bold;">run</span>: ; @-$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_BIN</span><span style="color: #4f97d7;">)</span>/$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">BIN</span><span style="color: #4f97d7;">)</span>

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: watch
<span style="color: #bc6ec5; font-weight: bold;">watch</span>:
  @echo <span style="color: #2d9574;">"Observando cambios en la aplicación..."</span>
  @while true; do $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">MAKE</span><span style="color: #4f97d7;">)</span> -q || $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">MAKE</span><span style="color: #4f97d7;">)</span> --no-print-directory; sleep <span style="color: #a45bad;">1</span>; done


</pre>
</div>
</div>
</div>
<div id="outline-container-org25b4326" class="outline-3">
<h3 id="org25b4326"><span class="section-number-3">8.3.</span> Proyecto Intermedio en C - Alternativa #2 (file dependency + watch)</h3>
<div class="outline-text-3" id="text-8-3">
<blockquote>
<p>
Este ejemplo a diferencia del anterior, es que usamos algunos comandos <code>sed</code>, <code>fmt</code>, …
para resolver el problema de las dependencias (.d)
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #7590db;">MAKE</span> += -f commons-v3.mk
<span style="color: #7590db;">RM</span> = rm -rfv

<span style="color: #7590db;">DIR_DEP</span> := .dep
<span style="color: #7590db;">DIR_BIN</span> := bin
<span style="color: #7590db;">DIR_SRC</span> := src
<span style="color: #7590db;">DIR_OBJ</span> := .obj
<span style="color: #7590db;">DIRS</span> := $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_BIN</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #4f97d7;">)</span>
<span style="color: #7590db;">SRC</span> := $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">wildcard</span> $<span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #bc6ec5;">)</span>/*.c<span style="color: #4f97d7;">)</span>
<span style="color: #7590db;">DEP</span> := $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">SRC</span>:<span style="color: #7590db;">$</span><span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #bc6ec5;">)</span><span style="color: #7590db;">/%.c</span>=$<span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #bc6ec5;">)</span>/%.d<span style="color: #4f97d7;">)</span>
<span style="color: #7590db;">OBJ</span> := $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">SRC</span>:<span style="color: #7590db;">$</span><span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #bc6ec5;">)</span><span style="color: #7590db;">/%.c</span>=$<span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #bc6ec5;">)</span>/%.o<span style="color: #4f97d7;">)</span>
<span style="color: #7590db;">BIN</span> := app.out

<span style="color: #7590db;">CC</span> := gcc
<span style="color: #7590db;">CFLAGS</span> := -g <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">-Wall #-Wextra</span>
<span style="color: #7590db;">INCLUDE</span> :=./include
<span style="color: #7590db;">CPPFLAGS</span> :=-I$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">INCLUDE</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">le avisamos al pre-procesador de C donde encontrar los archivos de cabecera .h</span>
<span style="color: #7590db;">LDFLAGS</span> := -L/usr/include <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">gcc le indica al GNU linker la ruta donde buscar bibliotecas</span>
<span style="color: #7590db;">LDLIBS</span> := -lpthread -lcommons <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">gcc le indica al GNU linker que bibliotecas usar (agregar luego de los source files)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Ojo..! Estamos usando el operador "=" en vez de ":="</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">porque queremos que expansión de la macro sea recursiva (la asignación se dará más adelante, cuando se use en una regla)</span>

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: all
<span style="color: #bc6ec5; font-weight: bold;">all</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIRS</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_BIN</span><span style="color: #4f97d7;">)</span>/$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">BIN</span><span style="color: #4f97d7;">)</span>

<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">DIRS</span><span style="color: #4f97d7; font-weight: bold;">)</span>: ; @mkdir -p <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span>

<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">DIR_BIN</span><span style="color: #4f97d7; font-weight: bold;">)</span><span style="color: #bc6ec5; font-weight: bold;">/$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">BIN</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">OBJ</span><span style="color: #4f97d7;">)</span>
  @echo <span style="color: #2d9574;">"Enlazamos los objetos ("</span>$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">notdir</span> $<span style="color: #a45bad;">^</span><span style="color: #4f97d7;">)</span><span style="color: #2d9574;">") para crear el ejecutable ($(</span><span style="color: #7590db;">notdir</span><span style="color: #2d9574;"> </span><span style="color: #2d9574; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span><span style="color: #2d9574;">)) en $(</span><span style="color: #7590db;">dir</span><span style="color: #2d9574;"> </span><span style="color: #2d9574; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span><span style="color: #2d9574;">)"</span>
  @$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">LDFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #a45bad;">^</span> -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">LDLIBS</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Descripción de algunos de los comandos..</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">1. sed: agregar la ruta de los objects</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">2. sed: remueve el target, y cualquier \ slash invertido</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">3. fmt: lista las palabras con saltos de linea, convierte los espacios en saltos de linea, porque le damos un ancho de 1</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">4. sed: remueve los espacios al principio de linea, y agrega : al final de cada linea</span>
<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">OBJ</span><span style="color: #4f97d7; font-weight: bold;">)</span>: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #4f97d7;">)</span>/%.o: $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #4f97d7;">)</span>/%.c
  @echo <span style="color: #2d9574;">"Compilamos el archivo fuente ("</span>$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">notdir</span> $<span style="color: #a45bad;">&lt;</span><span style="color: #4f97d7;">)</span><span style="color: #2d9574;">") en objeto en"</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">dir</span> $<span style="color: #a45bad;">&lt;</span><span style="color: #4f97d7;">)</span>
  @$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CPPFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CFLAGS</span><span style="color: #4f97d7;">)</span> -c $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.c -o $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.o
  @$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CC</span><span style="color: #4f97d7;">)</span> -MM $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CPPFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">CFLAGS</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_SRC</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.c &gt; $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.d <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">obtenemos los archivos cabecera y los agregamos al dependency file (.d)</span>
  @rsync -z $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.d $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.d.tmp <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">copia temporal para trabajar</span>
  @sed -e <span style="color: #2d9574;">'s|.*:|$(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #2d9574;">)/</span><span style="color: #2d9574; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span><span style="color: #2d9574;">.o:|'</span> &lt; $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.d.tmp &gt; $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.d
  @sed -e <span style="color: #2d9574;">'s/.*://'</span> -e <span style="color: #2d9574;">'s/\\$$//'</span> &lt; $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.d.tmp | fmt -1 | \
  sed -e <span style="color: #2d9574;">'s/^ *//'</span> -e <span style="color: #2d9574;">'s/$$/:/'</span> &gt;&gt; $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.d
  @rm -f $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">*</span>.d.tmp <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">borramos la copia temporal</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">se sugiere que la directiva "include" esté luego de la definición de la macro que se usa como target,</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">ó mejor aún al final del Makefile</span>
<span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #4f97d7; font-weight: bold;">(</span><span style="color: #bc6ec5; font-weight: bold;">DEP</span><span style="color: #4f97d7; font-weight: bold;">)</span>:
<span style="color: #4f97d7; font-weight: bold;">include</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">wildcard</span> $<span style="color: #bc6ec5;">(</span><span style="color: #7590db;">DEP</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">- tiene la DESVENTAJA que sólo estamos viendo 1 archivo de cabecera por .h</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Ej. player.c tendrá player.h, pero y si también tiene item.h y otro.h</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">entonces player.o debería de crearse nuevamente...</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">$(</span><span style="color: #7590db; background-color: #292e34;">OBJ</span><span style="color: #2aa1ae; background-color: #292e34;">): $(</span><span style="color: #7590db; background-color: #292e34;">DIR_OBJ</span><span style="color: #2aa1ae; background-color: #292e34;">)/%.o: $(</span><span style="color: #7590db; background-color: #292e34;">DIR_SRC</span><span style="color: #2aa1ae; background-color: #292e34;">)/%.c $(</span><span style="color: #7590db; background-color: #292e34;">INCLUDE</span><span style="color: #2aa1ae; background-color: #292e34;">)/%.h</span>
<span style="color: #2aa1ae; background-color: #292e34;">#   </span><span style="color: #2aa1ae; background-color: #292e34;">@echo "Compilamos el archivo fuente ("$(</span><span style="color: #7590db; background-color: #292e34;">notdir</span><span style="color: #2aa1ae; background-color: #292e34;"> $</span><span style="color: #a45bad; background-color: #292e34;">&lt;</span><span style="color: #2aa1ae; background-color: #292e34;">)") en objeto en" $(</span><span style="color: #7590db; background-color: #292e34;">dir</span><span style="color: #2aa1ae; background-color: #292e34;"> $</span><span style="color: #a45bad; background-color: #292e34;">&lt;</span><span style="color: #2aa1ae; background-color: #292e34;">)</span>
<span style="color: #2aa1ae; background-color: #292e34;">#   </span><span style="color: #2aa1ae; background-color: #292e34;">@$(</span><span style="color: #7590db; background-color: #292e34;">CC</span><span style="color: #2aa1ae; background-color: #292e34;">) $(</span><span style="color: #7590db; background-color: #292e34;">CPPFLAGS</span><span style="color: #2aa1ae; background-color: #292e34;">) $(</span><span style="color: #7590db; background-color: #292e34;">CFLAGS</span><span style="color: #2aa1ae; background-color: #292e34;">) -c $(</span><span style="color: #7590db; background-color: #292e34;">DIR_SRC</span><span style="color: #2aa1ae; background-color: #292e34;">)/</span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">*</span><span style="color: #2aa1ae; background-color: #292e34;">.c -o $(</span><span style="color: #7590db; background-color: #292e34;">DIR_OBJ</span><span style="color: #2aa1ae; background-color: #292e34;">)/</span><span style="color: #2aa1ae; background-color: #292e34; font-weight: bold;">$</span><span style="color: #a45bad; background-color: #292e34; font-weight: bold;">*</span><span style="color: #2aa1ae; background-color: #292e34;">.o</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">--------------------------------------------------------------------</span>

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: clean
<span style="color: #bc6ec5; font-weight: bold;">clean</span>:
  @echo <span style="color: #2d9574;">"Removiendo ejecutable, objetos y dependencias"</span>
  @-$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">RM</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_BIN</span><span style="color: #4f97d7;">)</span>/*.out
  @-$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">RM</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_OBJ</span><span style="color: #4f97d7;">)</span>/*.o
  @-$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">RM</span><span style="color: #4f97d7;">)</span> $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_DEP</span><span style="color: #4f97d7;">)</span>/*<span style="color: #4f97d7;">{</span>.d,.tmp.d<span style="color: #4f97d7;">}</span>

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: run
<span style="color: #bc6ec5; font-weight: bold;">run</span>: ; @-$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">DIR_BIN</span><span style="color: #4f97d7;">)</span>/$<span style="color: #4f97d7;">(</span><span style="color: #7590db;">BIN</span><span style="color: #4f97d7;">)</span>

<span style="color: #bc6ec5; font-weight: bold;">.PHONY</span>: watch
<span style="color: #bc6ec5; font-weight: bold;">watch</span>:
  @echo <span style="color: #2d9574;">"Observando cambios en la aplicación..."</span>
  @while true; do $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">MAKE</span><span style="color: #4f97d7;">)</span> -q || $<span style="color: #4f97d7;">(</span><span style="color: #7590db;">MAKE</span><span style="color: #4f97d7;">)</span> --no-print-directory; sleep <span style="color: #a45bad;">1</span>; done
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga5db37e" class="outline-2">
<h2 id="orga5db37e"><span class="section-number-2">9.</span> Ejemplos Interesantes</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-org85c0f4d" class="outline-3">
<h3 id="org85c0f4d"><span class="section-number-3">9.1.</span> Expresividad - Lineas muy extensas</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Si tenemos lineas muy extensas podemos usar el carácter <code>\</code> al igual que en <code>bash</code>
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #bc6ec5; font-weight: bold;">main.o</span>: main.c players.h monsters.h items.h \
configs.h events.h messages.h
</pre>
</div>
</div>
</div>
<div id="outline-container-org701518b" class="outline-3">
<h3 id="org701518b"><span class="section-number-3">9.2.</span> Generar varios ejecutables</h3>
<div class="outline-text-3" id="text-9-2">
<ul class="org-ul">
<li>Podemos usar <code>all</code> (se considea un <b>falso target</b>) cuando tenemos reglas para varios ejecutables,</li>
<li>Si no agregamos este target, sólo se ejecutará la regla 1
(porque es el target final, y la regla 2 no es una dependencia de ella)</li>
</ul>

<p>
<b>Observación:</b>
El <code>make</code> siempre considera la primera regla como el <a href="#org613e4ef">3.2</a> (el ejecutable),
y si la "regla 2" NO es una <b>dependencia</b> de esa primera regla, entonces no lo ejecutará.
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">hacemos que se ejecuten ambos por separado</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">porque no dependen entre ellos</span>
<span style="color: #bc6ec5; font-weight: bold;">all</span>: programa1 programa2

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">regla 1</span>
<span style="color: #bc6ec5; font-weight: bold;">programa1</span>: main.o players.o items.o
  gcc -o programa1 main.o players.o items.o

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">regla 2</span>
<span style="color: #bc6ec5; font-weight: bold;">programa2</span>: server.o configs.o
  gcc -o programa2 server.o configs.o
</pre>
</div>
</div>
</div>
<div id="outline-container-org7ea5079" class="outline-3">
<h3 id="org7ea5079"><span class="section-number-3">9.3.</span> Comandos en Shell diferentes</h3>
<div class="outline-text-3" id="text-9-3">
<p>
Cada comando se ejecuta en una <code>shell</code> diferente
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #bc6ec5; font-weight: bold;">programa</span>: players/items.c
  @cd players <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">se ejecuta en otra shell</span>
  gcc items.c -o <span style="color: #bc6ec5; font-weight: bold;">$</span><span style="color: #a45bad; font-weight: bold;">@</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">se ejecuta en otra shell</span>

<span style="color: #bc6ec5; font-weight: bold;">comando</span>:
  @cd test; echo <span style="color: #2d9574;">`pwd`</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">se ejecutan en la misma shell, imprimirá la ruta de la carpeta /test</span>
  @echo <span style="color: #2d9574;">`pwd`</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">éste se ejecuta en otra shell, imprimirá la ruta actual del makefile</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org7a3d533" class="outline-3">
<h3 id="org7a3d533"><span class="section-number-3">9.4.</span> Prioridad entre target y dependencia</h3>
<div class="outline-text-3" id="text-9-4">
<ul class="org-ul">
<li>GNU Make lee las dependencias de izquierda a derecha, y ejecuta las reglas en forma de bottom-up</li>
</ul>

<blockquote>
<p>
En este ejemplo, los <b>targets</b> son main.o, players.o, monsters.o
</p>

<p>
El <code>main.o</code> aparece en dos reglas
</p>
<ol class="org-ol">
<li>En la primera regla aparece como <b>dependencia</b></li>
<li>En la segunda regla aparece como <b>target</b> (esta se ejecutará primero)</li>
</ol>
</blockquote>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #bc6ec5; font-weight: bold;">juegito</span>: main.o players.o monsters.o
  gcc -o juegito main.o players.o monsters.o

<span style="color: #bc6ec5; font-weight: bold;">main.o</span>: main.c players.h players.c monsters.o
  gcc -c main.c

<span style="color: #bc6ec5; font-weight: bold;">players.o</span>: players.c players.h
  gcc -c players.c

<span style="color: #bc6ec5; font-weight: bold;">monsters.o</span>: monsters.c monsters.h
  gcc -c monsters.c
</pre>
</div>
</div>
</div>
<div id="outline-container-org7621352" class="outline-3">
<h3 id="org7621352"><span class="section-number-3">9.5.</span> Tips para Comandos de Linux</h3>
<div class="outline-text-3" id="text-9-5">
<ul class="org-ul">
<li>Usamos <code>mkdir -p nombreDirectorio</code> con el parámetro <code>-p</code> para evitar error si el directorio existe</li>
<li>Ejecutamos <code>rm -rf ruta/*{.d,.tmp.d}</code> con las llaves para extensiones específicas en la misma ruta</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org71d576f" class="outline-2">
<h2 id="org71d576f"><span class="section-number-2">10.</span> Referencias</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-org81cfd10" class="outline-3">
<h3 id="org81cfd10"><span class="section-number-3">10.1.</span> Referencias Oficiales</h3>
<div class="outline-text-3" id="text-10-1">
<ol class="org-ol">
<li><a href="https://www.gnu.org/software/make/manual/make.html">https://www.gnu.org/software/make/manual/make.html</a></li>
<li><a href="https://www.gnu.org/software/make/manual/html_node/Static-Usage.html">https://www.gnu.org/software/make/manual/html_node/Static-Usage.html</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc/Link-Options.html">GCC - Link Options (gcc.gnu.org)</a></li>
<li><a href="https://www.gnu.org/software/make/manual/html_node/Implicit-Variables.html">Implicit Variables (gnu.org/make)</a></li>
</ol>
</div>
</div>
<div id="outline-container-org7b54cf3" class="outline-3">
<h3 id="org7b54cf3"><span class="section-number-3">10.2.</span> Referencias Extraoficiales</h3>
<div class="outline-text-3" id="text-10-2">
<ol class="org-ol">
<li><a href="http://profesores.elo.utfsm.cl/~agv/elo320/makefile/makefile.html">http://profesores.elo.utfsm.cl/~agv/elo320/makefile/makefile.html</a></li>
<li><a href="https://www.zator.com/Cpp/E1_4_0a.htm">https://www.zator.com/Cpp/E1_4_0a.htm</a></li>
<li><a href="https://makefiletutorial.com/">https://makefiletutorial.com/</a></li>
<li><a href="http://nuclear.mutantstargoat.com/articles/make/">Practical Makefiles, by Example (nuclear.mutantstargoat.com)</a></li>
<li><a href="https://www.thegeekstuff.com/2012/10/gcc-compiler-options/">Most frequently used gcc cmd line options (thegeekstuff.com)</a></li>
<li><a href="http://make.mad-scientist.net/papers/advanced-auto-dependency-generation/">Advanced auto dependency generation (make.mad-scientist.net)</a></li>
<li><a href="https://scottmcpeak.com/autodepend/autodepend.html">Autodependencies with GNU Make (scottmcpeak.com)</a></li>
<li><a href="https://www.oreilly.com/library/view/managing-projects-with/0596006101/ch03.html">Variables and Macros - Managing Projects with GNU Make (oreilly.com)</a></li>
<li><a href="https://www.fatalerrors.org/a/gnu-makefile-generation-of-dependency-rules-for-c-c-header-files.html">Generation of dependency rules (fatalerrors.org)</a></li>
<li><a href="http://www.mathcs.emory.edu/~cheung/Courses/255/Syllabus/1-C-intro/make.html">The Make (UNIX) Utility (mathcs.emory.edu)</a></li>
<li><a href="https://www.it.uc3m.es/~pedmume/asignaturas/2005/LAO/Lab2/tutorial4/make.html">Construcción de archivos makefile (it.uc3m.es)</a></li>
<li><a href="https://swcarpentry.github.io/make-novice/reference.html">Automation and Make (swcarpentry.github.io)</a></li>
<li><a href="https://earthly.dev/blog/make-flags/">Understanding and using makefile Flags (earthly.dev)</a></li>
<li><a href="https://courses.cs.duke.edu/cps108/doc/makefileinfo/sample.html">A sample makefile and how it works (courses.cs.duke.edu)</a></li>
<li><a href="https://jjmerelo.medium.com/dos-o-tres-cosas-que-posiblemente-no-sepas-sobre-gnu-make-65f245f1c640">Cosas que posiblemente no sepas sobre gnu make #1 (jjmerelo.medmium.com)</a></li>
<li><a href="https://jjmerelo.medium.com/dos-o-tres-cosas-m%C3%A1s-que-posiblemente-no-sepas-sobre-gnu-make-9e012488e12a">Cosas que posiblemente no sepas sobre gnu make #2 (jjmerelo.medmium.com)</a></li>
<li><a href="https://www.islabit.com/94440/comando-ar-de-linux-usalo-para-crear-bibliotecas-estaticas.html">Comando AR, para crear bibliotecas estáticas (islabit.com)</a></li>
</ol>
</div>
</div>
<div id="outline-container-orgb08283c" class="outline-3">
<h3 id="orgb08283c"><span class="section-number-3">10.3.</span> Referencias Issues</h3>
<div class="outline-text-3" id="text-10-3">
<ol class="org-ol">
<li><a href="https://www.py4u.net/discuss/87388">Makefile vpath not working for header files (py4u.net)</a></li>
<li><a href="https://stackoverflow.com/questions/34219186/what-is-the-difference-between-and-in-a-makefile">What is the difference between % and * (stackoverflow.com)</a></li>
<li><a href="https://stackoverflow.com/questions/16751611/a-makefile-with-multiple-executables/16751650#16751650">A makefile with multiple executables (stackoverflow.com)</a></li>
<li><a href="https://stackoverflow.com/questions/48110661/how-to-add-headers-to-a-makefile">How to add headers to a Makefile (stackoverflow.com)</a></li>
<li><a href="https://stackoverflow.com/questions/2394609/makefile-header-dependencies">Makefile header dependencies (stackoverflow.com)</a></li>
<li><a href="https://stackoverflow.com/questions/13897945/wildcard-to-obtain-list-of-all-directories">Wildcard to obtain list of all directories (stackoverflow.com)</a></li>
<li><a href="https://stackoverflow.com/questions/4036191/sources-from-subdirectories-in-makefile/4038459">Sources from subdirectories in makefile (stackoverflow.com)</a></li>
<li><a href="https://stackoverflow.com/questions/7539563/is-there-a-smarter-alternative-to-watch-make">Alternative to watch make (stackoverflow.com)</a></li>
<li><a href="https://stackoverflow.com/questions/27318702/makefile-silence-the-maken-line-specifically">Makefile silence the maken line specifically (stackoverflow.com)</a></li>
</ol>
</div>
</div>
<div id="outline-container-org08c0c2c" class="outline-3">
<h3 id="org08c0c2c"><span class="section-number-3">10.4.</span> Referencias Youtube</h3>
<div class="outline-text-3" id="text-10-4">
<ol class="org-ol">
<li><a href="https://www.youtube.com/watch?v=E_ih19uktac">Module 05, Lecture 43 - Makefiles (by nptelhrd)</a></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org8715973" class="outline-2">
<h2 id="org8715973"><span class="section-number-2">11.</span> <span class="todo _TODO_">[TODO]</span> Referencias pendientes</h2>
<div class="outline-text-2" id="text-11">
<ol class="org-ol">
<li><a href="https://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/">https://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/</a></li>
<li><a href="https://randu.org/tutorials/c/make.php">https://randu.org/tutorials/c/make.php</a></li>
<li><a href="https://docs.oracle.com/cd/E19504-01/802-5880/6i9k05dhj/index.html">https://docs.oracle.com/cd/E19504-01/802-5880/6i9k05dhj/index.html</a></li>
<li><a href="https://docs.microsoft.com/en-us/cpp/build/reference/description-blocks?view=msvc-170">https://docs.microsoft.com/en-us/cpp/build/reference/description-blocks?view=msvc-170</a></li>
<li><a href="https://gist.github.com/kristopherjohnson/7466917">https://gist.github.com/kristopherjohnson/7466917</a></li>
<li><a href="https://tsh.io/blog/taskfile-and-gnu-make-for-automation/">https://tsh.io/blog/taskfile-and-gnu-make-for-automation/</a></li>
</ol>
</div>
</div>
<div id="outline-container-org9aa26cb" class="outline-2">
<h2 id="org9aa26cb"><span class="section-number-2">12.</span> Libros</h2>
<div class="outline-text-2" id="text-12">
<ol class="org-ol">
<li><a href="https://www.oreilly.com/openbook/make3/book/">https://www.oreilly.com/openbook/make3/book/</a></li>
</ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: jelou</p>
<p class="date">Created: 2022-01-18 mar 10:59</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>


</body></html>